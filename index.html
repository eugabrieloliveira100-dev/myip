<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CPDBZNF3CT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CPDBZNF3CT');
    </script>

    <!-- JSON-LD Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Check My IP Today",
      "url": "https://checkmyip.today/",
      "description": "Professional tool to detect your public IPv4 and IPv6 addresses with real-time geolocation, ISP details, and VPN detection.",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "IPv4 Detection",
        "IPv6 Detection",
        "Real-time Geolocation",
        "ISP and ASN identification",
        "VPN and Proxy Security Check"
      ]
    }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What is My IP Address? | Full Public IP Checker (IPv4 & IPv6)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#111827', 
                        'secondary-dark': '#1F2937', 
                        'accent': '#3B82F6', 
                        'error': '#EF4444', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .ip-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .ip-card.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #3B82F6; 
            border-radius: 50%;
            width: 30px; 
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .copy-btn {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-primary-dark text-gray-100 min-h-screen flex flex-col font-sans p-4">

    <!-- Header -->
    <header class="text-center py-6 relative">
        <div class="flex flex-col items-center justify-center space-y-2 mb-4">
            <div class="flex items-center justify-center space-x-3">
                <h1 id="main-title" class="text-3xl font-bold tracking-tight">
                    Full IP <span class="text-accent">Checker</span>
                </h1>
                <button id="copy-all-button" class="copy-btn flex items-center justify-center p-2 text-xs bg-accent hover:bg-blue-600 text-white font-medium rounded-full shadow-md transition-all duration-200" title="Copy All Information">
                    <svg id="copy-all-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="absolute top-4 right-4 md:top-6 md:right-6 flex space-x-2">
            <button id="lang-toggle" class="px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-md">
                EN / PT
            </button>
            <button id="theme-toggle" class="px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-md">
                <!-- Icon via JS -->
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex justify-center py-8">
        <div id="ip-card" class="ip-card w-full max-w-2xl p-6 md:p-10 rounded-xl text-center">
            
            <!-- IP SEARCH TOOL SECTION -->
            <div id="ip-search-section" class="p-4 rounded-xl border-2 border-dashed mb-8">
                <h3 id="search-title" class="text-lg font-semibold mb-4 text-left">IP Lookup Tool</h3>
                <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                    <input id="ip-search-input" type="text" placeholder="Ex: 8.8.8.8 or 2001:4860:4860::8888" 
                           class="flex-grow p-3 rounded-lg border focus:ring-accent focus:border-accent"
                           aria-label="Enter an IP address to lookup">
                    <button id="ip-search-button" 
                            class="px-6 py-3 bg-accent hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                        Lookup
                    </button>
                </div>
                <p id="search-message" class="text-sm mt-3 text-left hidden"></p>
            </div>


            <h2 id="detected-ip-title" class="text-xl md:text-2xl font-semibold mb-8 pt-4 border-t">
                Your Detected IP Address
            </h2>

            <!-- IP Container -->
            <div id="ip-container" class="mb-8 flex flex-col space-y-8 w-full">
                
                <div id="ipv4-block" class="p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-lg font-semibold">IPv4</p>
                        <button id="copy-ipv4-button" class="copy-btn flex items-center justify-center px-4 py-2 text-sm bg-accent hover:bg-blue-600 text-white font-medium rounded-lg shadow-md transition-all duration-200 opacity-0 pointer-events-none" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" /></svg>
                            <span id="copy-ipv4-text">Copy</span>
                        </button>
                    </div>
                    <div id="ipv4-display" class="min-h-[50px] flex flex-col items-center justify-center text-center">
                        <div class="loader" role="status" aria-label="Loading IPv4"></div>
                        <p id="ipv4-status" class="mt-2 text-sm">Detecting...</p>
                    </div>
                </div>

                <div id="ipv6-block" class="p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-lg font-semibold">IPv6</p>
                        <button id="copy-ipv6-button" class="copy-btn flex items-center justify-center px-4 py-2 text-sm bg-accent hover:bg-blue-600 text-white font-medium rounded-lg shadow-md transition-all duration-200 opacity-0 pointer-events-none" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" /></svg>
                            <span id="copy-ipv6-text">Copy</span>
                        </button>
                    </div>
                    <div id="ipv6-display" class="min-h-[50px] flex flex-col items-center justify-center text-center">
                        <div class="loader" role="status" aria-label="Loading IPv6"></div>
                        <p id="ipv6-status" class="mt-2 text-sm">Detecting...</p>
                    </div>
                </div>

            </div>

            <div id="context-info-card" class="mt-8 pt-6 border-t text-left">
                <div class="mb-4">
                    <h2 id="geo-details-title" class="text-xl md:text-2xl font-semibold mb-1">
                        Geolocation Details
                    </h2>
                    <p id="geo-ip-source-display" class="text-sm italic text-gray-400">
                        Querying details for your IP...
                    </p>
                </div>
                
                <div id="geo-display" class="flex flex-col justify-center items-center h-20">
                    <div class="loader mr-3 mb-2"></div>
                    <p id="geo-status-loading" class="text-gray-400">Querying connection details...</p>
                </div>
            </div>
            
            <div id="geoip-warning-note" class="mt-6 p-4 rounded-xl border-l-4">
                <h3 id="geo-warning-title" class="text-base font-semibold mb-1"></h3>
                <p id="geo-warning-text" class="text-sm"></p>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-4 text-xs mt-auto">
        <div class="h-10 rounded-lg flex items-center justify-center mb-4 max-w-xl mx-auto">
            <p id="footer-privacy-text" class="text-sm italic">Privacy guaranteed: Your data is not stored.</p>
        </div>
        &copy; 2025 IP Checker. | <a href="#" id="privacy-policy-link" class="hover:text-gray-300">Privacy Policy</a>
    </footer>

    <script>
        const languageMap = {
            PT: {
                title: 'Verificador de IP Completo',
                detectedIpTitle: 'Seu Endereço IP Detectado',
                geoDetailsTitle: 'Detalhes da Geolocalização',
                searchToolTitle: 'Ferramenta de Pesquisa de IP',
                searchPlaceholder: 'Ex: 8.8.8.8 ou 2001:4860:4860::8888',
                searchButton: 'Verificar',
                copy: 'Copiar',
                copied: 'Copiado!',
                failed: 'Falha',
                detecting: 'Detectando...',
                notDetected: 'Não Detectado',
                loadingIpv4: 'Carregando IPv4',
                loadingIpv6: 'Carregando IPv6',
                copyAll: 'Copiar Todas as Informações',
                allCopied: 'Tudo Copiado!',
                country: 'País',
                city: 'Cidade',
                timezone: 'Fuso Horário', 
                asn: 'Número do Sistema Autônomo (ASN)', 
                isp: 'Organização / Provedor', 
                connectionType: 'Tipo de Conexão',
                typeDatacenter: 'Datacenter / Hospedagem (Cloud)',
                typeResidential: 'Residencial / Corporativo',
                typeUnknown: 'Desconhecido',
                securityTitle: 'Informações de Segurança',
                securityStatus: 'Status de Uso',
                isProxy: 'Proxy Detectado',
                isVpn: 'VPN Dedicada Detectada',
                isTor: 'Nó TOR Detectado',
                isClean: 'Conexão Limpa', 
                detected: 'Sim (Risco)',
                notDetectedSec: 'Não',
                searchInvalid: 'Endereço IP inválido. Por favor, insira um IPv4 ou IPv6 válido.',
                searchSuccess: 'Detalhes para o IP pesquisado abaixo.',
                searchError: 'Falha ao buscar detalhes para este IP.',
                sourceMyIp: 'Consultando detalhes para o seu IP...',
                sourceSearchedIp: 'Detalhes para o IP pesquisado:',
                statusLoadingGeo: 'Consultando detalhes da conexão...',
                errorGeo: 'Não foi possível obter detalhes de geolocalização.',
                footerInfo: 'O endereço IP é a base para a identificação da sua localização aproximada e provedor de serviço.',
                footerPrivacy: 'Privacidade garantida: Seus dados não são armazenados.',
                privacyPolicy: 'Política de Privacidade',
                geoWarningTitle: '⚠️ Nota sobre a Precisão da Geolocalização',
                geoWarningText: 'A precisão da geolocalização por IP é uma estimativa. Endereços **IPv6** frequentemente apontam para o PoP (Ponto de Presença) principal do provedor (ex: São Paulo), e não para sua localização exata. Seu IPv4 é geralmente mais preciso.',
            },
            EN: {
                title: 'Full IP Checker',
                detectedIpTitle: 'Your Detected IP Address',
                geoDetailsTitle: 'Geolocation Details',
                searchToolTitle: 'IP Lookup Tool',
                searchPlaceholder: 'Ex: 8.8.8.8 or 2001:4860:4860::8888',
                searchButton: 'Lookup',
                copy: 'Copy',
                copied: 'Copied!',
                failed: 'Failed',
                detecting: 'Detecting...',
                notDetected: 'Not Detected',
                loadingIpv4: 'Loading IPv4',
                loadingIpv6: 'Loading IPv6',
                copyAll: 'Copy All Information',
                allCopied: 'All Copied!',
                country: 'Country',
                city: 'City',
                timezone: 'Timezone', 
                asn: 'Autonomous System Number (ASN)', 
                isp: 'Organization / Provider (ISP)', 
                connectionType: 'Connection Type',
                typeDatacenter: 'Datacenter / Hosting (Cloud)',
                typeResidential: 'Residential / Corporate',
                typeUnknown: 'Unknown',
                securityTitle: 'Security Information',
                securityStatus: 'Usage Status',
                isProxy: 'Proxy Detected',
                isVpn: 'Dedicated VPN Detected',
                isTor: 'TOR Node Detected',
                isClean: 'Clean Connection', 
                detected: 'Yes (Risk)',
                notDetectedSec: 'No',
                searchInvalid: 'Invalid IP address. Please enter a valid IPv4 or IPv6.',
                searchSuccess: 'Details for the searched IP are displayed below.',
                searchError: 'Failed to fetch details for this IP.',
                sourceMyIp: 'Querying details for your IP...',
                sourceSearchedIp: 'Details for searched IP:',
                statusLoadingGeo: 'Querying connection details...',
                errorGeo: 'Could not retrieve geolocation details.',
                footerInfo: 'The IP address is the basis for identifying your approximate location and service provider.',
                footerPrivacy: 'Privacy guaranteed: Your data is not stored.',
                privacyPolicy: 'Privacy Policy',
                geoWarningTitle: '⚠️ Geolocation Accuracy Note',
                geoWarningText: 'IP geolocation accuracy is an estimate. **IPv6** addresses frequently point to the provider’s main PoP (Point of Presence) (e.g., New York), not your exact physical location. Your IPv4 is generally more precise.',
            }
        };

        let currentLang = 'EN'; 
        let currentTheme = 'dark'; 
        let userIpv4 = null;
        let userIpv6 = null;
        let currentGeoData = null; 
        let currentGeoIp = null;    

        const API_GEO_BASE = 'https://ipapi.co/'; 
        const IPV4_ENDPOINTS = [
            { url: 'https://api.ipify.org?format=json', parser: data => data.ip },
            { url: 'https://api.bigdatacloud.net/data/client-ip', parser: data => data.ipString },
        ];
        const IPV6_ENDPOINTS = [
            { url: 'https://api6.ipify.org?format=json', parser: data => data.ip },
            { url: 'https://ipapi.co/ip', parser: data => data.trim(), isText: true } 
        ];

        const ipv4Regex = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
        const ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|([0-9a-fA-F]{1,4}:){1,4}:(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))$/;

        async function delay(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        async function resilientFetchAndParse(endpoint, maxRetries = 3) {
            const { url, parser, isText = false } = endpoint;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                    let data = isText ? await response.text() : await response.json();
                    let ip = parser(data);
                    if (ip && ip.trim) ip = ip.trim();
                    if (ip && (ipv4Regex.test(ip) || ipv6Regex.test(ip))) return ip;
                    throw new Error("Invalid IP");
                } catch (error) {
                    if (i < maxRetries - 1) await delay(Math.pow(2, i) * 1000);
                    else throw error;
                }
            }
        }
        
        async function robustFetchIp(endpoints) {
            for (const endpoint of endpoints) {
                try { return await resilientFetchAndParse(endpoint, 1); } catch (e) {}
            }
            return null;
        }

        function isValidIp(ip) { return ipv4Regex.test(ip) || ipv6Regex.test(ip); }

        async function resilientFetch(url, options = {}, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (i < maxRetries - 1) await delay(Math.pow(2, i) * 1000);
                } catch (error) {
                    if (i < maxRetries - 1) await delay(Math.pow(2, i) * 1000);
                    else throw error;
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const ipCard = document.getElementById('ip-card');
            const langToggleButton = document.getElementById('lang-toggle');
            const themeToggleButton = document.getElementById('theme-toggle');
            const copyAllButton = document.getElementById('copy-all-button');
            const ipv4Display = document.getElementById('ipv4-display');
            const copyIpv4Button = document.getElementById('copy-ipv4-button');
            const copyIpv4Text = document.getElementById('copy-ipv4-text');
            const ipv4StatusText = document.getElementById('ipv4-status');
            const ipv4Block = document.getElementById('ipv4-block');
            const ipv6Display = document.getElementById('ipv6-display');
            const copyIpv6Button = document.getElementById('copy-ipv6-button');
            const copyIpv6Text = document.getElementById('copy-ipv6-text');
            const ipv6StatusText = document.getElementById('ipv6-status');
            const ipv6Block = document.getElementById('ipv6-block');
            const geoDisplay = document.getElementById('geo-display');
            const geoStatusLoadingText = document.getElementById('geo-status-loading');
            const contextInfoCard = document.getElementById('context-info-card');
            const geoIpSourceDisplay = document.getElementById('geo-ip-source-display');
            const geoDetailsTitle = document.getElementById('geo-details-title');
            const geoWarningNote = document.getElementById('geoip-warning-note');
            const geoWarningTitle = document.getElementById('geo-warning-title');
            const geoWarningText = document.getElementById('geo-warning-text');
            const body = document.body;
            const mainTitle = document.getElementById('main-title');
            const detectedIpTitle = document.getElementById('detected-ip-title');
            const footerPrivacyText = document.getElementById('footer-privacy-text');
            const privacyPolicyLink = document.getElementById('privacy-policy-link');
            const footerContainer = document.querySelector('footer > div');
            const copyAllIcon = document.getElementById('copy-all-icon');
            const ipSearchInput = document.getElementById('ip-search-input');
            const ipSearchButton = document.getElementById('ip-search-button');
            const ipSearchSection = document.getElementById('ip-search-section');
            const searchMessage = document.getElementById('search-message');

            const copyIconSvg = `<path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />`;
            const checkIconSvg = `<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />`;

            function applyThemeClasses(element, role) {
                const darkClasses = {
                    body: 'bg-primary-dark text-gray-100',
                    card: 'bg-secondary-dark border border-gray-700/50 shadow-2xl',
                    innerBlock: 'bg-gray-800 border border-gray-700 transition-shadow hover:shadow-lg',
                    geoCard: 'bg-gray-700/50',
                    footerBox: 'bg-gray-800/30 border border-gray-700/50',
                    toggleButton: 'bg-gray-700 hover:bg-gray-600 text-gray-100 border border-gray-600',
                    title: 'text-white',
                    subtitle: 'text-gray-300',
                    text: 'text-gray-100',
                    statusText: 'text-gray-500',
                    statusLoading: 'text-gray-400',
                    footerText: 'text-gray-500',
                    link: 'hover:text-gray-300',
                    border: 'border-gray-700',
                    searchBorder: 'border-gray-700/50',
                    searchInput: 'bg-gray-900 border-gray-700 text-white placeholder-gray-500',
                    searchMessage: 'text-gray-300',
                    geoWarningNote: 'bg-yellow-900/30 border-yellow-500 text-yellow-100', 
                    geoWarningText: 'text-yellow-200/90',
                    geoWarningTitle: 'text-yellow-100'
                };
                const lightClasses = {
                    body: 'bg-gray-100 text-gray-900',
                    card: 'bg-white border border-gray-300 shadow-xl',
                    innerBlock: 'bg-gray-200 border border-gray-300 transition-shadow hover:shadow-md',
                    geoCard: 'bg-gray-300',
                    footerBox: 'bg-gray-300/50 border border-gray-300',
                    toggleButton: 'bg-white hover:bg-gray-100 text-gray-800 border border-gray-300',
                    title: 'text-gray-900',
                    subtitle: 'text-gray-700',
                    text: 'text-gray-900',
                    statusText: 'text-gray-600',
                    statusLoading: 'text-gray-500',
                    footerText: 'text-gray-700',
                    link: 'hover:text-gray-700',
                    border: 'border-gray-300',
                    searchBorder: 'border-gray-300',
                    searchInput: 'bg-white border-gray-300 text-gray-900 placeholder-gray-400',
                    searchMessage: 'text-gray-700',
                    geoWarningNote: 'bg-yellow-100 border-yellow-600 text-yellow-800',
                    geoWarningText: 'text-yellow-800',
                    geoWarningTitle: 'text-yellow-900'
                };
                const classes = currentTheme === 'dark' ? darkClasses : lightClasses;
                element.className = element.className.split(' ').filter(c => !Object.values(darkClasses).join(' ').includes(c) && !Object.values(lightClasses).join(' ').includes(c)).join(' ');
                element.classList.add(...classes[role].split(' '));
            }

            function applyTheme() {
                applyThemeClasses(body, 'body');
                applyThemeClasses(ipCard, 'card');
                applyThemeClasses(ipv4Block, 'innerBlock');
                applyThemeClasses(ipv6Block, 'innerBlock');
                applyThemeClasses(ipSearchSection, 'searchBorder');
                applyThemeClasses(ipSearchInput, 'searchInput');
                applyThemeClasses(searchMessage, 'searchMessage');
                applyThemeClasses(geoWarningNote, 'geoWarningNote');
                applyThemeClasses(geoWarningTitle, 'geoWarningTitle');
                applyThemeClasses(geoWarningText, 'geoWarningText');
                applyThemeClasses(contextInfoCard, 'border');
                applyThemeClasses(mainTitle, 'title');
                applyThemeClasses(detectedIpTitle, 'subtitle');
                applyThemeClasses(document.getElementById('search-title'), 'subtitle');
                applyThemeClasses(geoDetailsTitle, 'subtitle');
                applyThemeClasses(geoIpSourceDisplay, 'statusLoading');
                applyThemeClasses(footerContainer, 'footerBox');
                applyThemeClasses(footerPrivacyText, 'footerText');
                applyThemeClasses(privacyPolicyLink, 'link');
                applyThemeClasses(langToggleButton, 'toggleButton');
                applyThemeClasses(themeToggleButton, 'toggleButton');
                themeToggleButton.innerHTML = currentTheme === 'dark' ? '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.041A6.99 6.99 0 0110 2a8 8 0 000 16 7.99 7.99 0 007.293-4.959z" /></svg>' : '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.95a1 1 0 101.414 1.414l.707-.707a1 1 0 00-1.414-1.414l-.707.707zm1.414-8.486l-.707-.707a1 1 0 011.414-1.414l.707.707a1 1 0 01-1.414 1.414zM3 11a1 1 0 100-2H2a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>';
                updateIpBlock(userIpv4, ipv4Display, copyIpv4Button, copyIpv4Text, languageMap[currentLang].copy, 'text-3xl md:text-5xl');
                updateIpBlock(userIpv6, ipv6Display, copyIpv6Button, copyIpv6Text, languageMap[currentLang].copy, 'text-xl md:text-3xl');
                renderGeoDetails(currentGeoData, currentGeoIp);
            }

            themeToggleButton.addEventListener('click', () => { currentTheme = currentTheme === 'dark' ? 'light' : 'dark'; applyTheme(); });

            function translatePage() {
                const lang = languageMap[currentLang];
                document.documentElement.lang = currentLang === 'PT' ? 'pt-BR' : 'en-US';
                langToggleButton.textContent = currentLang === 'PT' ? 'EN / PT' : 'PT / EN';
                mainTitle.innerHTML = lang.title.replace('Full', `<span class="text-accent">Full</span>`).replace('Completo', `<span class="text-accent">Completo</span>`);
                detectedIpTitle.textContent = lang.detectedIpTitle;
                document.getElementById('search-title').textContent = lang.searchToolTitle;
                ipSearchInput.placeholder = lang.searchPlaceholder;
                ipSearchButton.textContent = lang.searchButton;
                geoDetailsTitle.textContent = lang.geoDetailsTitle;
                geoWarningTitle.textContent = lang.geoWarningTitle;
                geoWarningText.textContent = lang.geoWarningText;
                footerPrivacyText.textContent = lang.footerPrivacy;
                privacyPolicyLink.textContent = lang.privacyPolicy;
                applyTheme();
            }
            
            langToggleButton.addEventListener('click', () => { currentLang = currentLang === 'PT' ? 'EN' : 'PT'; translatePage(); });

            function copyToClipboard(ip, buttonElement, textElement) {
                const lang = languageMap[currentLang];
                const tempInput = document.createElement('textarea');
                tempInput.value = ip;
                document.body.appendChild(tempInput);
                tempInput.select();
                if (document.execCommand('copy')) {
                    textElement.textContent = lang.copied;
                    setTimeout(() => { textElement.textContent = lang.copy; }, 1500);
                }
                document.body.removeChild(tempInput);
            }

            copyAllButton.addEventListener('click', () => {
                const lang = languageMap[currentLang];
                let allData = `${lang.title} (${currentLang})\n---\nIPv4: ${userIpv4 || 'N/A'}\nIPv6: ${userIpv6 || 'N/A'}\nLocation: ${currentGeoData?.city}, ${currentGeoData?.country}\nISP: ${currentGeoData?.isp}`;
                const tempInput = document.createElement('textarea');
                tempInput.value = allData;
                document.body.appendChild(tempInput);
                tempInput.select();
                if (document.execCommand('copy')) {
                    copyAllIcon.innerHTML = checkIconSvg;
                    setTimeout(() => { copyAllIcon.innerHTML = copyIconSvg; }, 2000);
                }
                document.body.removeChild(tempInput);
            });

            function updateIpBlock(ip, displayEl, buttonEl, textEl, buttonText, fontSizeClass) {
                if (ip) {
                    displayEl.innerHTML = `<p class="${fontSizeClass} font-extrabold text-accent break-all select-text leading-tight">${ip}</p>`;
                    textEl.textContent = buttonText;
                    buttonEl.onclick = () => copyToClipboard(ip, buttonEl, textEl);
                    buttonEl.disabled = false;
                    buttonEl.className = buttonEl.className.replace('opacity-0', 'opacity-100').replace('pointer-events-none', '').replace('bg-gray-500', 'bg-accent');
                } else {
                    displayEl.innerHTML = `<p class="text-2xl text-gray-500 font-extrabold">${languageMap[currentLang].notDetected}</p>`;
                    buttonEl.disabled = true;
                    buttonEl.classList.add('opacity-0', 'pointer-events-none');
                }
            }
            
            async function fetchGeoDetails(ip) {
                try {
                    const response = await resilientFetch(`${API_GEO_BASE}${ip}/json/`); 
                    const data = await response.json();
                    if (data.error) return null;
                    return { country: data.country_name, city: data.city, isp: data.org, asn: data.asn, timezone: data.timezone, isProxy: data.proxy, isVpn: data.vpn, isTor: data.security?.is_tor };
                } catch (e) { return null; }
            }
            
            function renderGeoDetails(data, ip, sourceKey = 'sourceMyIp') {
                const lang = languageMap[currentLang];
                currentGeoData = data; currentGeoIp = ip;
                geoIpSourceDisplay.textContent = sourceKey === 'sourceSearchedIp' ? `${lang.sourceSearchedIp} ${ip}` : lang.sourceMyIp;
                geoDisplay.className = '';
                if (!data) {
                    geoDisplay.innerHTML = `<p class="text-red-500 text-center">${lang.errorGeo}</p>`;
                    return;
                }
                const isRisky = data.isProxy || data.isVpn || data.isTor;
                geoDisplay.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-sm md:text-base">
                        ${['country', 'city', 'timezone', 'asn', 'isp'].map(k => `<div class="col-span-2 flex flex-col p-3 ${currentTheme === 'dark' ? 'bg-gray-700/50' : 'bg-gray-300'} rounded-lg"><span class="font-medium opacity-70">${lang[k]}</span><span class="font-extrabold">${data[k] || 'N/A'}</span></div>`).join('')}
                    </div>
                    <div class="mt-8 p-4 rounded-lg border ${isRisky ? 'border-red-500/50 bg-red-900/10' : 'border-green-500/50 bg-green-900/10'}">
                        <h3 class="font-bold mb-2">${lang.securityTitle}</h3>
                        <p>${isRisky ? lang.detected : lang.isClean}</p>
                    </div>
                `;
            }

            ipSearchButton.addEventListener('click', async () => {
                const inputIp = ipSearchInput.value.trim();
                if (!isValidIp(inputIp)) { searchMessage.textContent = languageMap[currentLang].searchInvalid; searchMessage.classList.remove('hidden'); return; }
                geoDisplay.innerHTML = `<div class="loader"></div>`;
                const data = await fetchGeoDetails(inputIp);
                renderGeoDetails(data, inputIp, 'sourceSearchedIp');
            });

            async function init() {
                [userIpv4, userIpv6] = await Promise.all([robustFetchIp(IPV4_ENDPOINTS), robustFetchIp(IPV6_ENDPOINTS)]);
                const geo = await fetchGeoDetails(userIpv4 || userIpv6);
                renderGeoDetails(geo, userIpv4 || userIpv6);
                ipCard.classList.add('loaded');
                applyTheme();
            }
            
            init();
            translatePage();
        });
    </script>
</body>
</html>
