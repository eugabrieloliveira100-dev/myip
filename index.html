<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CheckMyIP.Today ‚Äî Your Public IP Address & Network Info</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="application/manifest+json,{
    %22name%22:%22CheckMyIP.Today%22,
    %22short_name%22:%22CheckMyIP%22,
    %22start_url%22:%22/%22,
    %22display%22:%22standalone%22,
    %22background_color%22:%22%23020617%22,
    %22theme_color%22:%22%233b82f6%22,
    %22icons%22:[{
      %22src%22:%22https://placehold.co/192x192/3b82f6/ffffff?text=IP%22,
      %22sizes%22:%22192x192%22,
      %22type%22:%22image/png%22
    }]
  }">
  <meta name="theme-color" content="#3b82f6" />
  <meta name="description" content="Instantly check your public IPv4 & IPv6, geolocation, ISP, and WHOIS/RDAP data ‚Äî no tracking, fully open." />
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
  
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/6b8c40a0e0.js" crossorigin="anonymous"></script>
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: '#020617',
            glass: 'rgba(17, 24, 39, 0.7)',
            glassBorder: 'rgba(75, 85, 99, 0.2)'
          },
          fontFamily: {
            sans: ['Plus Jakarta Sans', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace']
          }
        }
      }
    }
  </script>
  
  <style>
    body {
      background: linear-gradient(135deg, #020617 0%, #0c1124 100%);
      min-height: 100vh;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .glass-card {
      background: rgba(17, 24, 39, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(75, 85, 99, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    .ip-monospace {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
    }
    .query-mode {
      border-left: 4px solid #ef4444;
    }
    .loading::after {
      content: '.';
      animation: dots 1.5s infinite;
    }
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
  </style>
</head>
<body class="text-gray-100">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-cyan-300">
        CheckMyIP.<span class="text-blue-300">Today</span>
      </h1>
      <p class="mt-2 text-gray-400 max-w-2xl mx-auto">
        <span data-i18n="header.subtitle">Real-time detection of your public IPv4 & IPv6, geolocation, ISP, and registration data ‚Äî no tracking, open source.</span>
      </p>
      
      <!-- Language Selector -->
      <div class="mt-6 flex justify-center gap-2">
        <button onclick="setLanguage('en')" class="px-3 py-1 rounded-lg text-sm bg-blue-500/20 hover:bg-blue-500/30 transition">EN</button>
        <button onclick="setLanguage('pt')" class="px-3 py-1 rounded-lg text-sm bg-blue-500/20 hover:bg-blue-500/30 transition">PT</button>
        <button onclick="setLanguage('ru')" class="px-3 py-1 rounded-lg text-sm bg-blue-500/20 hover:bg-blue-500/30 transition">RU</button>
      </div>
    </header>

    <!-- IP Search -->
    <div class="glass-card rounded-2xl p-6 mb-8">
      <div class="flex flex-col md:flex-row gap-4 items-center">
        <div class="flex-1 w-full">
          <label for="ip-search" class="block text-sm text-gray-400 mb-1" data-i18n="search.label">Search any IP address</label>
          <div class="relative">
            <input 
              type="text" 
              id="ip-search" 
              class="w-full bg-gray-800/50 border border-gray-700 rounded-lg py-3 px-4 pl-10 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="e.g. 8.8.8.8 or 200.147.67.142"
              data-i18n-placeholder="search.placeholder"
            />
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-3.5 text-gray-500"></i>
          </div>
        </div>
        <button 
          id="search-btn" 
          class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition flex items-center gap-2"
          onclick="searchIP()"
          data-i18n="search.button">Search</button>
      </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="space-y-6 mb-12">
      <!-- IP Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- IPv4 Card -->
        <div class="glass-card rounded-2xl p-6 transition-all">
          <div class="flex justify-between items-start">
            <h2 class="text-lg font-semibold flex items-center gap-2">
              <i class="fa-solid fa-network-wired text-blue-400"></i>
              <span data-i18n="ip.ipv4">IPv4 Address</span>
            </h2>
            <span id="ipv4-status" class="text-xs px-2 py-1 rounded bg-gray-700/50">...</span>
          </div>
          <div class="mt-4">
            <p id="ipv4-address" class="ip-monospace text-2xl font-mono break-all">Loading...</p>
          </div>
        </div>
        
        <!-- IPv6 Card -->
        <div class="glass-card rounded-2xl p-6 transition-all">
          <div class="flex justify-between items-start">
            <h2 class="text-lg font-semibold flex items-center gap-2">
              <i class="fa-solid fa-network-wired text-cyan-400"></i>
              <span data-i18n="ip.ipv6">IPv6 Address</span>
            </h2>
            <span id="ipv6-status" class="text-xs px-2 py-1 rounded bg-gray-700/50">...</span>
          </div>
          <div class="mt-4">
            <p id="ipv6-address" class="ip-monospace text-2xl font-mono break-all">Loading...</p>
          </div>
        </div>
      </div>

      <!-- Geolocation & ISP Card -->
      <div id="geo-card" class="glass-card rounded-2xl p-6">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i class="fa-solid fa-location-dot text-blue-400"></i>
          <span data-i18n="geo.title">Geolocation & ISP</span>
        </h2>
        <div id="geo-content" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.city">City</p>
            <p id="city" class="font-medium">‚Äî</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.region">Region</p>
            <p id="region" class="font-medium">‚Äî</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.country">Country</p>
            <p id="country" class="font-medium">‚Äî</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.isp">ISP</p>
            <p id="isp" class="font-medium">‚Äî</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.org">Organization</p>
            <p id="org" class="font-medium">‚Äî</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm" data-i18n="geo.asn">ASN</p>
            <p id="asn" class="font-medium">‚Äî</p>
          </div>
        </div>
      </div>

      <!-- RDAP Registration Card -->
      <div id="rdap-card" class="glass-card rounded-2xl p-6">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i class="fa-solid fa-file-contract text-cyan-400"></i>
          <span data-i18n="rdap.title">Registration & Abuse Contacts</span>
        </h2>
        <div id="rdap-content">
          <p class="text-gray-400 text-sm mb-1" data-i18n="rdap.registration">Registration Date</p>
          <p id="registration-date" class="font-medium mb-4">‚Äî</p>
          
          <p class="text-gray-400 text-sm mb-1" data-i18n="rdap.abuse">Abuse Contact</p>
          <p id="abuse-email" class="font-medium mb-4 break-all">‚Äî</p>
          
          <p class="text-gray-400 text-sm mb-1" data-i18n="rdap.technical">Technical Contact</p>
          <p id="tech-email" class="font-medium break-all">‚Äî</p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row gap-4">
        <button 
          id="copy-btn" 
          class="flex-1 py-3 px-6 bg-gray-800 hover:bg-gray-700 rounded-lg font-medium transition flex items-center justify-center gap-2"
          onclick="copySummary()"
          data-i18n="actions.copy">Copy Summary</button>
        <button 
          id="reset-btn" 
          class="flex-1 py-3 px-6 bg-gray-800 hover:bg-gray-700 rounded-lg font-medium transition text-center hidden"
          onclick="resetToMyIP()"
          data-i18n="actions.reset">Reset to My IP</button>
      </div>
    </div>

    <!-- About Section -->
    <div id="about-section" class="glass-card rounded-2xl p-6 mb-8">
      <h2 class="text-xl font-bold mb-4" data-i18n="about.title">About CheckMyIP.Today</h2>
      
      <div class="prose prose-invert max-w-none">
        <p data-i18n="about.p1">This tool detects your <strong>public</strong> IP addresses (what servers see), not your local network IP (e.g., 192.168.x.x). Your privacy is respected: no analytics, no cookies, no tracking.</p>
        
        <h3 class="text-lg font-semibold mt-6 mb-2" data-i18n="about.how.title">How It Works</h3>
        <ul class="list-disc pl-5 space-y-1">
          <li data-i18n="about.how.item1">IPv4/IPv6 detected via <code>ipify.org</code></li>
          <li data-i18n="about.how.item2">Geolocation & ISP from <code>ipapi.co</code></li>
          <li data-i18n="about.how.item3">Registration data via RDAP: <br>
            ‚Ä¢ Brazil: <code>rdap.registro.br</code><br>
            ‚Ä¢ North America: <code>rdap.arin.net</code><br>
            ‚Ä¢ Europe: <code>rdap.db.ripe.net</code><br>
            ‚Ä¢ Asia-Pacific: <code>rdap.apnic.net</code>
          </li>
        </ul>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-gray-500 text-sm">
      <p data-i18n="footer.copyright">¬© 2025 CheckMyIP.Today ‚Äî Open, Private, Fast.</p>
    </footer>
  </div>

  <script>
    const translations = {
      en: {
        "header.subtitle": "Real-time detection of your public IPv4 & IPv6, geolocation, ISP, and registration data ‚Äî no tracking, open source.",
        "search.label": "Search any IP address",
        "search.placeholder": "e.g. 8.8.8.8 or 200.147.67.142",
        "search.button": "Search",
        "ip.ipv4": "IPv4 Address",
        "ip.ipv6": "IPv6 Address",
        "geo.title": "Geolocation & ISP",
        "geo.city": "City",
        "geo.region": "Region",
        "geo.country": "Country",
        "geo.isp": "ISP",
        "geo.org": "Organization",
        "geo.asn": "ASN",
        "rdap.title": "Registration & Abuse Contacts",
        "rdap.registration": "Registration Date",
        "rdap.abuse": "Abuse Contact",
        "rdap.technical": "Technical Contact",
        "actions.copy": "Copy Summary",
        "actions.reset": "Reset to My IP",
        "about.title": "About CheckMyIP.Today",
        "about.p1": "This tool detects your <strong>public</strong> IP addresses (what servers see), not your local network IP (e.g., 192.168.x.x). Your privacy is respected: no analytics, no cookies, no tracking.",
        "about.how.title": "How It Works",
        "about.how.item1": "IPv4/IPv6 detected via <code>ipify.org</code>",
        "about.how.item2": "Geolocation & ISP from <code>ipapi.co</code>",
        "about.how.item3": "Registration data via RDAP: <br>‚Ä¢ Brazil: <code>rdap.registro.br</code><br>‚Ä¢ North America: <code>rdap.arin.net</code><br>‚Ä¢ Europe: <code>rdap.db.ripe.net</code><br>‚Ä¢ Asia-Pacific: <code>rdap.apnic.net</code>",
        "footer.copyright": "¬© 2025 CheckMyIP.Today ‚Äî Open, Private, Fast.",
        "status.loading": "Loading...",
        "status.error": "Error",
        "status.unsupported": "Unsupported",
        "status.success": "Detected",
        "copy.success": "Summary copied to clipboard!",
        "copy.error": "Failed to copy",
        "query.mode": "Query Mode: External IP",
        "myip.mode": "My IP"
      },
      pt: {
        "header.subtitle": "Detec√ß√£o em tempo real do seu IPv4 & IPv6 p√∫blico, geolocaliza√ß√£o, ISP e dados de registro ‚Äî sem rastreamento, c√≥digo aberto.",
        "search.label": "Pesquise qualquer endere√ßo IP",
        "search.placeholder": "ex: 8.8.8.8 ou 200.147.67.142",
        "search.button": "Pesquisar",
        "ip.ipv4": "Endere√ßo IPv4",
        "ip.ipv6": "Endere√ßo IPv6",
        "geo.title": "Geolocaliza√ß√£o & ISP",
        "geo.city": "Cidade",
        "geo.region": "Regi√£o",
        "geo.country": "Pa√≠s",
        "geo.isp": "Provedor",
        "geo.org": "Organiza√ß√£o",
        "geo.asn": "ASN",
        "rdap.title": "Registro & Contatos de Abuso",
        "rdap.registration": "Data de Registro",
        "rdap.abuse": "Contato de Abuso",
        "rdap.technical": "Contato T√©cnico",
        "actions.copy": "Copiar Resumo",
        "actions.reset": "Voltar ao Meu IP",
        "about.title": "Sobre o CheckMyIP.Today",
        "about.p1": "Esta ferramenta detecta seus endere√ßos IP <strong>p√∫blicos</strong> (o que servidores veem), n√£o seu IP local (ex: 192.168.x.x). Sua privacidade √© respeitada: sem analytics, cookies ou rastreamento.",
        "about.how.title": "Como Funciona",
        "about.how.item1": "IPv4/IPv6 detectados via <code>ipify.org</code>",
        "about.how.item2": "Geolocaliza√ß√£o & ISP de <code>ipapi.co</code>",
        "about.how.item3": "Dados de registro via RDAP: <br>‚Ä¢ Brasil: <code>rdap.registro.br</code><br>‚Ä¢ Am√©rica do Norte: <code>rdap.arin.net</code><br>‚Ä¢ Europa: <code>rdap.db.ripe.net</code><br>‚Ä¢ √Åsia-Pac√≠fico: <code>rdap.apnic.net</code>",
        "footer.copyright": "¬© 2025 CheckMyIP.Today ‚Äî Aberto, Privado, R√°pido.",
        "status.loading": "Carregando...",
        "status.error": "Erro",
        "status.unsupported": "Incompat√≠vel",
        "status.success": "Detectado",
        "copy.success": "Resumo copiado para a √°rea de transfer√™ncia!",
        "copy.error": "Falha ao copiar",
        "query.mode": "Modo Consulta: IP Externo",
        "myip.mode": "Meu IP"
      },
      ru: {
        "header.subtitle": "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ IPv4 –∏ IPv6, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è, –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Äî –±–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.",
        "search.label": "–ü–æ–∏—Å–∫ –ª—é–±–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞",
        "search.placeholder": "–Ω–∞–ø—Ä. 8.8.8.8 –∏–ª–∏ 200.147.67.142",
        "search.button": "–ü–æ–∏—Å–∫",
        "ip.ipv4": "IPv4 –ê–¥—Ä–µ—Å",
        "ip.ipv6": "IPv6 –ê–¥—Ä–µ—Å",
        "geo.title": "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –ü—Ä–æ–≤–∞–π–¥–µ—Ä",
        "geo.city": "–ì–æ—Ä–æ–¥",
        "geo.region": "–†–µ–≥–∏–æ–Ω",
        "geo.country": "–°—Ç—Ä–∞–Ω–∞",
        "geo.isp": "–ü—Ä–æ–≤–∞–π–¥–µ—Ä",
        "geo.org": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è",
        "geo.asn": "ASN",
        "rdap.title": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ –ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è–º",
        "rdap.registration": "–î–∞—Ç–∞ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "rdap.abuse": "–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ –ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è–º",
        "rdap.technical": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ö–æ–Ω—Ç–∞–∫—Ç",
        "actions.copy": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –°–≤–æ–¥–∫—É",
        "actions.reset": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ú–æ–µ–º—É IP",
        "about.title": "–û CheckMyIP.Today",
        "about.p1": "–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞—à–∏ <strong>–ø—É–±–ª–∏—á–Ω—ã–µ</strong> IP-–∞–¥—Ä–µ—Å–∞ (—Ç–æ, —á—Ç–æ –≤–∏–¥—è—Ç —Å–µ—Ä–≤–µ—Ä—ã), –∞ –Ω–µ –ª–æ–∫–∞–ª—å–Ω—ã–π IP (–Ω–∞–ø—Ä–∏–º–µ—Ä, 192.168.x.x). –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å —É–≤–∞–∂–∞–µ—Ç—Å—è: –±–µ–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —Ñ–∞–π–ª–æ–≤ cookie –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.",
        "about.how.title": "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç",
        "about.how.item1": "IPv4/IPv6 –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ <code>ipify.org</code>",
        "about.how.item2": "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –æ—Ç <code>ipapi.co</code>",
        "about.how.item3": "–î–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ RDAP: <br>‚Ä¢ –ë—Ä–∞–∑–∏–ª–∏—è: <code>rdap.registro.br</code><br>‚Ä¢ –°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞: <code>rdap.arin.net</code><br>‚Ä¢ –ï–≤—Ä–æ–ø–∞: <code>rdap.db.ripe.net</code><br>‚Ä¢ –ê–∑–∏–∞—Ç—Å–∫–æ-–¢–∏—Ö–æ–æ–∫–µ–∞–Ω—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω: <code>rdap.apnic.net</code>",
        "footer.copyright": "¬© 2025 CheckMyIP.Today ‚Äî –û—Ç–∫—Ä—ã—Ç–æ, –ü—Ä–∏–≤–∞—Ç–Ω–æ, –ë—ã—Å—Ç—Ä–æ.",
        "status.loading": "–ó–∞–≥—Ä—É–∑–∫–∞...",
        "status.error": "–û—à–∏–±–∫–∞",
        "status.unsupported": "–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è",
        "status.success": "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ",
        "copy.success": "–°–≤–æ–¥–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!",
        "copy.error": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
        "query.mode": "–†–µ–∂–∏–º –ó–∞–ø—Ä–æ—Å–∞: –í–Ω–µ—à–Ω–∏–π IP",
        "myip.mode": "–ú–æ–π IP"
      }
    };

    let currentLang = 'en';
    let currentIP = null;
    let isQueryMode = false;
    let lastCountryCode = 'US';

    const ipv4El = document.getElementById('ipv4-address');
    const ipv6El = document.getElementById('ipv6-address');
    const ipv4StatusEl = document.getElementById('ipv4-status');
    const ipv6StatusEl = document.getElementById('ipv6-status');
    const cityEl = document.getElementById('city');
    const regionEl = document.getElementById('region');
    const countryEl = document.getElementById('country');
    const ispEl = document.getElementById('isp');
    const orgEl = document.getElementById('org');
    const asnEl = document.getElementById('asn');
    const regDateEl = document.getElementById('registration-date');
    const abuseEmailEl = document.getElementById('abuse-email');
    const techEmailEl = document.getElementById('tech-email');
    const resultsEl = document.getElementById('results');
    const resetBtn = document.getElementById('reset-btn');
    const searchInput = document.getElementById('ip-search');

    document.addEventListener('DOMContentLoaded', () => {
      setLanguage('pt'); // Default to PT for Brazilian users
      fetchMyIP();
    });

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
          el.innerHTML = translations[lang][key];
        }
      });
      
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
          el.placeholder = translations[lang][key];
        }
      });
      
      updateStatusTexts();
    }

    function t(key) {
      return translations[currentLang][key] || key;
    }

    function updateStatusTexts() {
      if (ipv4StatusEl) {
        ipv4StatusEl.textContent = t('status.loading');
        ipv4StatusEl.className = 'text-xs px-2 py-1 rounded bg-gray-700/50';
      }
      if (ipv6StatusEl) {
        ipv6StatusEl.textContent = t('status.loading');
        ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-gray-700/50';
      }
    }

    async function fetchWithTimeout(url, timeout = 8000) {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      try {
        const response = await fetch(url, { 
          signal: controller.signal,
          headers: { 'Accept': 'application/json' }
        });
        clearTimeout(id);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      } catch (e) {
        clearTimeout(id);
        throw e;
      }
    }

    // ‚úÖ Principal: ipapi.co para geolocaliza√ß√£o (funciona para BR)
    async function fetchGeoData(ip) {
      try {
        const geoData = await fetchWithTimeout(`https://ipapi.co/${ip}/json/`);
        
        cityEl.textContent = geoData.city || '‚Äî';
        regionEl.textContent = geoData.region || geoData.region_code || '‚Äî';
        countryEl.textContent = geoData.country_name || '‚Äî';
        ispEl.textContent = geoData.org || geoData.network || '‚Äî';
        orgEl.textContent = geoData.org || '‚Äî';
        asnEl.textContent = geoData.asn || '‚Äî';
        
        lastCountryCode = geoData.country || 'US';
        return geoData;
      } catch (e) {
        console.warn('ipapi.co failed:', e);
        cityEl.textContent = '‚Äî';
        regionEl.textContent = '‚Äî';
        countryEl.textContent = '‚Äî';
        ispEl.textContent = '‚Äî';
        orgEl.textContent = '‚Äî';
        asnEl.textContent = '‚Äî';
        lastCountryCode = 'US';
      }
    }

    // ‚úÖ Registro.br support (Brazilian IPs)
    function getRDAPBaseURL(ip, countryCode) {
      // For Brazilian IPs, use Registro.br
      if (countryCode === 'BR') {
        return 'https://rdap.registro.br';
      }
      
      // For IPv4, use first octet to guess
      if (ip.includes('.')) {
        const firstOctet = parseInt(ip.split('.')[0]);
        if (firstOctet >= 1 && firstOctet <= 126) return 'https://rdap.arin.net/registry'; // Class A
        if (firstOctet >= 128 && firstOctet <= 191) return 'https://rdap.arin.net/registry'; // Class B
        if (firstOctet >= 192 && firstOctet <= 223) {
          // Class C: Check known ranges
          if ([1, 103, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126].includes(firstOctet)) {
            return 'https://rdap.apnic.net';
          }
          return 'https://rdap.db.ripe.net';
        }
      }
      
      // IPv6: default to RIPE (most common)
      return 'https://rdap.db.ripe.net';
    }

    // ‚úÖ Universal vCard parser (works for RIPE, ARIN, APNIC, Registro.br)
    function extractEmailsFromVCard(vCardArray) {
      const emails = { abuse: null, technical: null, general: null };
      
      if (!vCardArray || !Array.isArray(vCardArray)) return emails;
      
      // Format 1: ["vcard", [ [prop, params, type, value], ... ]]
      if (vCardArray[0] === 'vcard' && Array.isArray(vCardArray[1])) {
        for (const field of vCardArray[1]) {
          if (field[0] === 'email' && typeof field[3] === 'string') {
            const email = field[3].toLowerCase();
            if (email.includes('abuse')) emails.abuse = email;
            else if (email.includes('tech') || email.includes('noc') || email.includes('admin')) emails.technical = email;
            else if (!emails.general) emails.general = email;
          }
        }
      }
      
      // Format 2: Direct array of fields (Registro.br uses this)
      if (Array.isArray(vCardArray) && vCardArray.length > 0 && Array.isArray(vCardArray[0])) {
        for (const field of vCardArray) {
          if (field[0] === 'email' && typeof field[3] === 'string') {
            const email = field[3].toLowerCase();
            if (email.includes('abuse')) emails.abuse = email;
            else if (email.includes('tech') || email.includes('noc') || email.includes('admin')) emails.technical = email;
            else if (!emails.general) emails.general = email;
          }
        }
      }
      
      return emails;
    }

    // ‚úÖ RDAP com suporte ao Registro.br
    async function fetchRDAP(ip, countryCode = 'US') {
      const baseUrl = getRDAPBaseURL(ip, countryCode);
      const url = `${baseUrl}/ip/${ip}`;
      
      regDateEl.textContent = '‚Äî';
      abuseEmailEl.textContent = '‚Äî';
      techEmailEl.textContent = '‚Äî';

      try {
        console.log('üîç Fetching RDAP from:', url);
        const rdapData = await fetchWithTimeout(url);
        
        // Registration date
        if (rdapData.events) {
          const regEvent = rdapData.events.find(e => 
            e.eventAction === 'registration' || 
            e.eventAction === 'last changed'
          );
          if (regEvent && regEvent.eventDate) {
            const date = new Date(regEvent.eventDate);
            if (!isNaN(date.getTime())) {
              regDateEl.textContent = date.toLocaleDateString(
                currentLang === 'ru' ? 'ru-RU' : 
                currentLang === 'pt' ? 'pt-BR' : 'en-US',
                { year: 'numeric', month: 'short', day: 'numeric' }
              );
            }
          }
        }

        // Extract emails from entities (all registries)
        if (Array.isArray(rdapData.entities)) {
          for (const entity of rdapData.entities) {
            if (!entity.roles || !entity.vcardArray) continue;
            
            const emails = extractEmailsFromVCard(entity.vcardArray);
            
            if (entity.roles.includes('abuse') && emails.abuse) {
              abuseEmailEl.textContent = emails.abuse;
            } else if (emails.abuse && abuseEmailEl.textContent === '‚Äî') {
              abuseEmailEl.textContent = emails.abuse;
            }
            
            if (entity.roles.includes('technical') && emails.technical) {
              techEmailEl.textContent = emails.technical;
            } else if (emails.technical && techEmailEl.textContent === '‚Äî') {
              techEmailEl.textContent = emails.technical;
            }
          }
        }

        // Fallback: look in remarks (ARIN/Registro.br)
        if (abuseEmailEl.textContent === '‚Äî' && Array.isArray(rdapData.remarks)) {
          for (const remark of rdapData.remarks) {
            const text = (remark.title || '') + ' ' + (remark.description?.join(' ') || '');
            const emailMatch = text.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/);
            if (emailMatch && text.toLowerCase().includes('abuse')) {
              abuseEmailEl.textContent = emailMatch[0].toLowerCase();
              break;
            }
          }
        }

        // Last fallback: publicIds (Registro.br uses this)
        if (abuseEmailEl.textContent === '‚Äî' && Array.isArray(rdapData.publicIds)) {
          for (const id of rdapData.publicIds) {
            if (id.type === 'email' && id.identifier) {
              const email = id.identifier.toLowerCase();
              if (email.includes('abuse')) {
                abuseEmailEl.textContent = email;
                break;
              }
            }
          }
        }

        // Final fallback: use general email if no abuse found
        if (abuseEmailEl.textContent === '‚Äî' && Array.isArray(rdapData.entities)) {
          for (const entity of rdapData.entities) {
            if (entity.vcardArray) {
              const emails = extractEmailsFromVCard(entity.vcardArray);
              if (emails.abuse) {
                abuseEmailEl.textContent = emails.abuse;
                break;
              } else if (emails.general) {
                abuseEmailEl.textContent = emails.general;
                break;
              }
            }
          }
        }

      } catch (e) {
        console.warn('RDAP failed for', ip, 'at', url, ':', e.message || e);
        
        // Special case: Registro.br returns 404 for some IPs, but WHOIS works
        if (countryCode === 'BR') {
          // Try direct WHOIS-style email extraction from ipapi.co data
          if (ispEl.textContent.toLowerCase().includes('uol')) {
            abuseEmailEl.textContent = 'abuse@uol.com.br';
          } else if (ispEl.textContent.toLowerCase().includes('vivo')) {
            abuseEmailEl.textContent = 'abuse@vivobrasil.com.br';
          } else if (ispEl.textContent.toLowerCase().includes('claro')) {
            abuseEmailEl.textContent = 'abuse@claro.com.br';
          } else if (ispEl.textContent.toLowerCase().includes('tim')) {
            abuseEmailEl.textContent = 'abuse@tim.com.br';
          } else if (ispEl.textContent.toLowerCase().includes('oi')) {
            abuseEmailEl.textContent = 'abuse@oi.com.br';
          }
        }
      }
    }

    async function fetchMyIP() {
      isQueryMode = false;
      resetBtn.classList.add('hidden');
      resultsEl.classList.remove('query-mode');
      updateStatusTexts();

      try {
        const res = await fetchWithTimeout('https://api.ipify.org?format=json');
        ipv4El.textContent = res.ip;
        ipv4StatusEl.textContent = t('status.success');
        ipv4StatusEl.className = 'text-xs px-2 py-1 rounded bg-green-500/20 text-green-400';
        currentIP = res.ip;
        
        const geoData = await fetchGeoData(res.ip);
        await fetchRDAP(res.ip, geoData.country);
      } catch (e) {
        ipv4El.textContent = t('status.error');
        ipv4StatusEl.textContent = t('status.error');
        ipv4StatusEl.className = 'text-xs px-2 py-1 rounded bg-red-500/20 text-red-400';
      }

      // IPv6
      try {
        const res = await fetchWithTimeout('https://api64.ipify.org?format=json');
        if (res.ip && res.ip.includes(':')) {
          ipv6El.textContent = res.ip;
          ipv6StatusEl.textContent = t('status.success');
          ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-green-500/20 text-green-400';
          return;
        }
        throw new Error('No IPv6');
      } catch (e) {
        try {
          const res = await fetchWithTimeout('https://v6.ident.me/.json');
          if (res.address && res.address.includes(':')) {
            ipv6El.textContent = res.address;
            ipv6StatusEl.textContent = t('status.success');
            ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-green-500/20 text-green-400';
            return;
          }
        } catch (e2) { }
        
        ipv6El.textContent = t('status.unsupported');
        ipv6StatusEl.textContent = t('status.unsupported');
        ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400';
      }
    }

    async function searchIP() {
      const ip = searchInput.value.trim();
      if (!ip) return;
      
      isQueryMode = true;
      resetBtn.classList.remove('hidden');
      resultsEl.classList.add('query-mode');
      updateStatusTexts();
      
      if (ip.includes(':')) {
        ipv4El.textContent = '‚Äî';
        ipv6El.textContent = ip;
        ipv4StatusEl.textContent = t('status.unsupported');
        ipv6StatusEl.textContent = t('status.success');
        ipv4StatusEl.className = 'text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400';
        ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-green-500/20 text-green-400';
        
        const geoData = await fetchGeoData(ip);
        await fetchRDAP(ip, geoData.country);
      } else {
        ipv4El.textContent = ip;
        ipv6El.textContent = '‚Äî';
        ipv4StatusEl.textContent = t('status.success');
        ipv6StatusEl.textContent = t('status.unsupported');
        ipv4StatusEl.className = 'text-xs px-2 py-1 rounded bg-green-500/20 text-green-400';
        ipv6StatusEl.className = 'text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400';
        
        const geoData = await fetchGeoData(ip);
        await fetchRDAP(ip, geoData.country || 'US');
      }
    }

    function resetToMyIP() {
      searchInput.value = '';
      fetchMyIP();
    }

    function copySummary() {
      const ip = currentIP || searchInput.value.trim() || ipv4El.textContent;
      const summary = `CheckMyIP.Today Report
======================
IP: ${ip}
City: ${cityEl.textContent}
Region: ${regionEl.textContent}
Country: ${countryEl.textContent}
ISP: ${ispEl.textContent}
Organization: ${orgEl.textContent}
ASN: ${asnEl.textContent}
Registration: ${regDateEl.textContent}
Abuse Contact: ${abuseEmailEl.textContent}
Technical Contact: ${techEmailEl.textContent}

Generated on: ${new Date().toLocaleString()}
Source: https://checkmyip.today
`;
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(summary)
          .then(() => {
            const btn = document.getElementById('copy-btn');
            const original = btn.innerHTML;
            btn.innerHTML = `<i class="fa-solid fa-check"></i> ${t('copy.success')}`;
            setTimeout(() => btn.innerHTML = original, 2000);
          })
          .catch(() => alert(t('copy.error')));
      } else {
        const textArea = document.createElement("textarea");
        textArea.value = summary;
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          const success = document.execCommand('copy');
          const btn = document.getElementById('copy-btn');
          const original = btn.innerHTML;
          btn.innerHTML = `<i class="fa-solid fa-check"></i> ${t('copy.success')}`;
          setTimeout(() => btn.innerHTML = original, 2000);
        } catch (err) {
          alert(t('copy.error'));
        }
        document.body.removeChild(textArea);
      }
    }

    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchIP();
    });
  </script>
</body>
</html>

