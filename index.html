<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CPDBZNF3CT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CPDBZNF3CT');
    </script>

    <!-- JSON-LD Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Check My IP Today",
      "url": "https://checkmyip.today/",
      "description": "Professional tool to detect your public IPv4 and IPv6 addresses with real-time geolocation, ISP details, and VPN detection.",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "IPv4 Detection",
        "IPv6 Detection",
        "Real-time Geolocation",
        "ISP and ASN identification",
        "VPN and Proxy Security Check",
        "WebRTC Leak Detection",
        "Advanced Whois Lookup"
      ]
    }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What is My IP Address? | Full Public IP Checker (IPv4 & IPv6)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#111827', 
                        'secondary-dark': '#1F2937', 
                        'accent': '#3B82F6', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .ip-card { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; }
        .ip-card.loaded { opacity: 1; transform: translateY(0); }
        .loader { border: 4px solid rgba(0,0,0,0.1); border-top: 4px solid #3B82F6; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        .dark .loader { border: 4px solid rgba(255, 255, 255, 0.1); border-top: 4px solid #3B82F6; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .terminal-box { background-color: #0d0d0d; color: #10b981; font-family: 'Fira Code', 'Courier New', monospace; border: 1px solid #333; }
        .webrtc-tag { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: bold; }
        .ip-clickable { cursor: pointer; text-decoration: underline dotted; transition: color 0.2s; }
        .ip-clickable:hover { color: #60a5fa; }
        .whois-label { color: #6b7280; font-weight: bold; min-width: 140px; display: inline-block; }
        .whois-value { color: #e5e7eb; }
        .whois-section-title { color: #3b82f6; border-bottom: 1px solid #1e293b; margin-top: 1rem; margin-bottom: 0.5rem; padding-bottom: 2px; font-weight: bold; text-transform: uppercase; font-size: 0.75rem; }
    </style>
</head>
<body class="bg-primary-dark text-gray-100 min-h-screen flex flex-col font-sans p-4 transition-colors duration-300">

    <!-- Header -->
    <header class="text-center py-6 relative">
        <div class="flex flex-col items-center justify-center space-y-2 mb-4">
            <div class="flex items-center justify-center space-x-3">
                <h1 id="main-title" class="text-3xl font-bold tracking-tight">
                    Full IP <span class="text-accent">Checker</span>
                </h1>
                <button id="copy-all-button" class="flex items-center justify-center p-2 text-xs bg-accent hover:bg-blue-600 text-white font-medium rounded-full shadow-md transition-all duration-200" title="Copy All Information">
                    <svg id="copy-all-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="absolute top-4 right-4 md:top-6 md:right-6 flex flex-wrap justify-end gap-2">
            <select id="lang-selector" class="px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-sm border border-gray-700 bg-secondary-dark text-white outline-none cursor-pointer">
                <option value="EN">English</option>
                <option value="PT">Portugu√™s</option>
                <option value="ID">Indonesia</option>
                <option value="VN">Ti·∫øng Vi·ªát</option>
            </select>
            <button id="theme-toggle" class="px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-sm border border-gray-700 bg-secondary-dark hover:bg-gray-700 text-white">
                üåô
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center py-8">
        <div id="ip-card" class="ip-card w-full max-w-2xl p-6 md:p-10 rounded-xl text-center mb-8">
            
            <!-- IP SEARCH TOOL SECTION -->
            <div id="ip-search-section" class="p-4 rounded-xl border-2 border-dashed mb-8">
                <h3 id="search-title" class="text-lg font-semibold mb-4 text-left">IP Lookup Tool</h3>
                <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                    <input id="ip-search-input" type="text" placeholder="Ex: 8.8.8.8" 
                           class="flex-grow p-3 rounded-lg border focus:ring-accent focus:border-accent">
                    <button id="ip-search-button" class="px-6 py-3 bg-accent hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition-colors">
                        Lookup
                    </button>
                </div>
                <p id="search-message" class="text-sm mt-3 text-left hidden"></p>
            </div>

            <h2 id="detected-ip-title" class="text-xl md:text-2xl font-semibold mb-8 pt-4 border-t border-gray-700/30">
                Your Detected IP Address
            </h2>

            <!-- IP Container -->
            <div id="ip-container" class="mb-8 flex flex-col space-y-8 w-full">
                <div id="ipv4-block" class="p-6 rounded-xl border">
                    <div class="flex justify-between items-center mb-4">
                        <p id="ipv4-label" class="text-lg font-semibold">IPv4</p>
                        <button id="copy-ipv4-button" class="flex items-center justify-center px-4 py-2 text-sm bg-accent hover:bg-blue-600 text-white font-medium rounded-lg opacity-0 pointer-events-none transition-all" disabled>
                            <span id="copy-ipv4-text">Copy</span>
                        </button>
                    </div>
                    <div id="ipv4-display" class="min-h-[50px] flex flex-col items-center justify-center">
                        <div class="loader"></div>
                    </div>
                </div>

                <div id="ipv6-block" class="p-6 rounded-xl border">
                    <div class="flex justify-between items-center mb-4">
                        <p id="ipv6-label" class="text-lg font-semibold">IPv6</p>
                        <button id="copy-ipv6-button" class="flex items-center justify-center px-4 py-2 text-sm bg-accent hover:bg-blue-600 text-white font-medium rounded-lg opacity-0 pointer-events-none transition-all" disabled>
                            <span id="copy-ipv6-text">Copy</span>
                        </button>
                    </div>
                    <div id="ipv6-display" class="min-h-[50px] flex flex-col items-center justify-center">
                        <div class="loader"></div>
                    </div>
                </div>
            </div>

            <!-- WebRTC Leak Section -->
            <div id="webrtc-section" class="mt-8 p-6 rounded-xl border border-dashed text-left">
                <div class="flex items-center justify-between mb-2">
                    <h3 id="webrtc-title" class="text-lg font-bold flex items-center">
                        üîí WebRTC Leak Test
                    </h3>
                    <div id="webrtc-status-badge" class="webrtc-tag bg-gray-600 text-white">Checking...</div>
                </div>
                <p id="webrtc-note" class="text-xs mb-4">
                    WebRTC is a browser feature that can bypass your VPN and leak your real IP. If "Private/Real IP" matches your VPN IP, you are safe.
                </p>
                <div id="webrtc-results" class="space-y-2">
                    <div id="webrtc-result-box" class="flex justify-between items-center text-sm p-2 rounded">
                        <span id="webrtc-label-local">Private/Real IP:</span>
                        <span id="webrtc-local-ip" class="font-mono font-bold text-accent">Detecting...</span>
                    </div>
                </div>
            </div>

            <div id="context-info-card" class="mt-8 pt-6 border-t border-gray-700/30 text-left">
                <div class="mb-4">
                    <h2 id="geo-details-title" class="text-xl md:text-2xl font-semibold mb-1">Geolocation Details</h2>
                    <p id="geo-ip-source-display" class="text-sm italic">Querying details...</p>
                </div>
                <div id="geo-display" class="flex flex-col items-center justify-center min-h-[100px]">
                    <div class="loader mb-2"></div>
                </div>
            </div>

            <!-- WHOIS INFO SECTION (ADVANCED) -->
            <div id="whois-section" class="mt-8 pt-6 border-t border-gray-700/30 text-left hidden">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    üîç Network & Organization Details (Whois)
                </h3>
                <div id="whois-content" class="terminal-box p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
                    Loading technical details...
                </div>
                <p class="text-[10px] mt-2 opacity-50 italic">Data provided by Regional Internet Registries (RIR) via RDAP protocol.</p>
            </div>
            
            <div id="geoip-warning-note" class="mt-6 p-4 rounded-xl border-l-4">
                <h3 id="geo-warning-title" class="text-base font-semibold mb-1"></h3>
                <p id="geo-warning-text" class="text-sm"></p>
            </div>
        </div>

        <!-- EDUCATIONAL SECTION -->
        <div class="w-full max-w-2xl mt-4 px-4">
            <div id="edu-card" class="p-6 md:p-8 rounded-xl border shadow-lg">
                <h2 id="edu-section-title" class="text-2xl font-bold mb-6 text-accent">How to check your IP via Terminal</h2>
                <div class="space-y-6">
                    <div>
                        <h3 id="edu-win-title" class="text-lg font-semibold mb-2 flex items-center">ü™ü Windows</h3>
                        <p id="edu-win-desc" class="text-sm mb-2 opacity-80">Open terminal and type:</p>
                        <div class="terminal-box p-3 rounded-lg text-sm select-all">ipconfig</div>
                    </div>
                    <div>
                        <h3 id="edu-linux-title" class="text-lg font-semibold mb-2 flex items-center">üêß Linux / üçé macOS</h3>
                        <p id="edu-linux-desc" class="text-sm mb-2 opacity-80">Use these commands:</p>
                        <div class="terminal-box p-3 rounded-lg text-sm mb-1 select-all">ip a</div>
                        <div class="terminal-box p-3 rounded-lg text-sm select-all">ifconfig</div>
                    </div>
                    <p id="edu-footer-note" class="text-xs italic mt-4"></p>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-8 text-xs mt-auto">
        <p id="footer-privacy-text" class="mb-2">Privacy guaranteed: Your data is not stored.</p>
        <p>&copy; 2025 IP Checker. | <a href="#" id="privacy-policy-link" class="underline opacity-50 hover:opacity-100">Privacy Policy</a></p>
    </footer>

    <script>
        const languageMap = {
            PT: {
                title: 'Verificador de IP Completo',
                detectedIpTitle: 'Seu Endere√ßo IP Detectado',
                geoDetailsTitle: 'Detalhes da Geolocaliza√ß√£o',
                searchToolTitle: 'Ferramenta de Pesquisa de IP',
                searchPlaceholder: 'Ex: 8.8.8.8',
                searchButton: 'Verificar',
                copy: 'Copiar',
                copied: 'Copiado!',
                notDetected: 'N√£o Detectado',
                copyAll: 'Copiar Tudo',
                country: 'Pa√≠s', city: 'Cidade', timezone: 'Fuso Hor√°rio', asn: 'ASN', isp: 'Provedor (ISP)',
                securityTitle: 'Seguran√ßa', isClean: 'Conex√£o Limpa', detected: 'Sim (Risco)',
                searchInvalid: 'IP inv√°lido.',
                sourceMyIp: 'Consultando seus detalhes...',
                sourceSearchedIp: 'Detalhes para:',
                errorGeo: 'Erro ao obter localiza√ß√£o.',
                footerPrivacy: 'Privacidade garantida: Seus dados n√£o s√£o armazenados.',
                privacyPolicy: 'Pol√≠tica de Privacidade',
                geoWarningTitle: '‚ö†Ô∏è Precis√£o da Geolocaliza√ß√£o',
                geoWarningText: 'A precis√£o por IP √© uma estimativa. IPv6 geralmente aponta para a central do provedor, enquanto o IPv4 tende a ser mais preciso.',
                eduTitle: 'Como checar seu IP via Terminal',
                eduWinDesc: 'Abra o terminal e digite:',
                eduLinuxDesc: 'Use estes comandos:',
                eduFooter: 'Nota: Estes mostram o **IP local**. Para o **p√∫blico**, use: <code class="bg-gray-800 px-1 rounded text-accent">curl ifconfig.me</code>',
                webrtcTitle: 'üîí Teste de Vazamento WebRTC',
                webrtcNote: 'O WebRTC √© uma fun√ß√£o do navegador que pode ignorar a sua VPN e revelar o seu IP real. Se o "IP Privado/Real" for igual ao da sua VPN, est√° seguro.',
                webrtcLabel: 'IP Privado/Real:',
                webrtcSafe: 'SEGURO',
                webrtcLeaking: 'VAZAMENTO DETETADO',
                webrtcChecking: 'A verificar...',
                whoisTitle: 'üîç Detalhes do Whois',
                whoisLoading: 'Carregando detalhes t√©cnicos...'
            },
            EN: {
                title: 'Full IP Checker',
                detectedIpTitle: 'Your Detected IP Address',
                geoDetailsTitle: 'Geolocation Details',
                searchToolTitle: 'IP Lookup Tool',
                searchPlaceholder: 'Ex: 8.8.8.8',
                searchButton: 'Lookup',
                copy: 'Copy',
                copied: 'Copied!',
                notDetected: 'Not Detected',
                copyAll: 'Copy All',
                country: 'Country', city: 'City', timezone: 'Timezone', asn: 'ASN', isp: 'Provider (ISP)',
                securityTitle: 'Security', isClean: 'Clean Connection', detected: 'Yes (Risk)',
                searchInvalid: 'Invalid IP.',
                sourceMyIp: 'Querying details...',
                sourceSearchedIp: 'Details for:',
                errorGeo: 'Could not retrieve location.',
                footerPrivacy: 'Privacy guaranteed: Your data is not stored.',
                privacyPolicy: 'Privacy Policy',
                geoWarningTitle: '‚ö†Ô∏è Geolocation Accuracy',
                geoWarningText: 'IP accuracy is an estimate. IPv6 often points to the provider headquarters, while IPv4 is usually more precise.',
                eduTitle: 'How to check your IP via Terminal',
                eduWinDesc: 'Open terminal and type:',
                eduLinuxDesc: 'Use these commands:',
                eduFooter: 'Note: These show **local IP**. For **public IP**, use: <code class="bg-gray-800 px-1 rounded text-accent">curl ifconfig.me</code>',
                webrtcTitle: 'üîí WebRTC Leak Test',
                webrtcNote: 'WebRTC is a browser feature that can bypass your VPN and leak your real IP. If "Private/Real IP" matches your VPN IP, you are safe.',
                webrtcLabel: 'Private/Real IP:',
                webrtcSafe: 'SAFE',
                webrtcLeaking: 'LEAK DETECTED',
                webrtcChecking: 'Checking...',
                whoisTitle: 'üîç Whois Info',
                whoisLoading: 'Loading technical details...'
            },
            ID: {
                title: 'Pemeriksa IP Lengkap',
                detectedIpTitle: 'Alamat IP Anda Terdeteksi',
                geoDetailsTitle: 'Detail Geolokasi',
                searchToolTitle: 'Alat Pencarian IP',
                searchPlaceholder: 'Contoh: 8.8.8.8',
                searchButton: 'Cari',
                copy: 'Salin',
                copied: 'Tersalin!',
                notDetected: 'Tidak Terdeteksi',
                copyAll: 'Salin Semua',
                country: 'Negara', city: 'Kota', timezone: 'Zona Waktu', asn: 'ASN', isp: 'Penyedia (ISP)',
                securityTitle: 'Keamanan', isClean: 'Koneksi Aman', detected: 'Ya (Risiko)',
                searchInvalid: 'IP tidak valid.',
                sourceMyIp: 'Menampilkan detail Anda...',
                sourceSearchedIp: 'Detail untuk:',
                errorGeo: 'Gagal mengambil lokasi.',
                footerPrivacy: 'Privasi terjamin: Data Anda tidak disimpan.',
                privacyPolicy: 'Kebijakan Privasi',
                geoWarningTitle: '‚ö†Ô∏è Akurasi Geolokasi',
                geoWarningText: 'Akurasi IP adalah perkiraan. IPv6 sering merujuk ke kantor pusat penyedia, sementara IPv4 biasanya lebih tepat.',
                eduTitle: 'Cara cek IP via Terminal',
                eduWinDesc: 'Buka terminal dan ketik:',
                eduLinuxDesc: 'Gunakan perintah ini:',
                eduFooter: 'Catatan: Ini menunjukkan **IP lokal**. Para **IP publik**, gunakan: <code class="bg-gray-800 px-1 rounded text-accent">curl ifconfig.me</code>',
                webrtcTitle: 'üîí Uji Kebocoran WebRTC',
                webrtcNote: 'WebRTC √© uma fun√ß√£o do navegador que pode ignorar a sua VPN e revelar o seu IP real. Se o "IP Privado/Real" for igual ao da sua VPN, est√° seguro.',
                webrtcLabel: 'IP Privado/Asli:',
                webrtcSafe: 'AMAN',
                webrtcLeaking: 'KEBOCORAN TERDETEKSI',
                webrtcChecking: 'Memeriksa...',
                whoisTitle: 'üîç Info Whois',
                whoisLoading: 'Memuat detail teknis...'
            },
            VN: {
                title: 'C√¥ng C·ª• Ki·ªÉm Tra IP',
                detectedIpTitle: 'ƒê·ªãa Ch·ªâ IP C·ªßa B·∫°n',
                geoDetailsTitle: 'Chi Ti·∫øt V·ªã Tr√≠',
                searchToolTitle: 'Tra C·ª©u IP',
                searchPlaceholder: 'V√≠ d·ª•: 8.8.8.8',
                searchButton: 'Tra C·ª©u',
                copy: 'Sao Ch√©p',
                copied: 'ƒê√£ Ch√©p!',
                notDetected: 'Kh√¥ng T√¨m Th·∫•y',
                copyAll: 'Ch√©p T·∫•t C·∫£',
                country: 'Qu·ªëc Gia', city: 'Th√†nh Ph·ªë', timezone: 'M√∫i Gi·ªù', asn: 'ASN', isp: 'Nh√† M·∫°ng (ISP)',
                securityTitle: 'B·∫£o M·∫≠t', isClean: 'K·∫øt N·ªëi S·∫°ch', detected: 'C√≥ (R·ªßi Ro)',
                searchInvalid: 'IP kh√¥ng h·ª£p l·ªá.',
                sourceMyIp: 'ƒêang truy v·∫•n...',
                sourceSearchedIp: 'Chi ti·∫øt cho:',
                errorGeo: 'Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠.',
                footerPrivacy: 'Quy·ªÅn ri√™ng t∆∞ ƒë∆∞·ª£c ƒë·∫£m b·∫£o: D·ªØ li·ªáu kh√¥ng ƒë∆∞·ª£c l∆∞u tr·ªØ.',
                privacyPolicy: 'Ch√≠nh S√°ch B·∫£o M·∫≠t',
                geoWarningTitle: '‚ö†Ô∏è ƒê·ªô Ch√≠nh X√°c V·ªã Tr√≠',
                geoWarningText: 'V·ªã tr√≠ IP ch·ªâ l√† ∆∞·ªõc t√≠nh. IPv6 th∆∞·ªùng ch·ªâ v·ªÅ tr·ª• s·ªü nh√† m·∫°ng, trong khi IPv4 th∆∞·ªùng ch√≠nh x√°c h∆°n.',
                eduTitle: 'C√°ch ki·ªÉm tra IP qua Terminal',
                eduWinDesc: 'M·ªü terminal v√† g√µ:',
                eduLinuxDesc: 'S·ª≠ d·ª•ng l·ªánh sau:',
                eduFooter: 'L∆∞u √Ω: C√°c l·ªánh n√†y hi·ªÉn th·ªã **IP n·ªôi b·ªô**. V·ªõi **IP c√¥ng c·ªông**, h√£y d√πng: <code class="bg-gray-800 px-1 rounded text-accent">curl ifconfig.me</code>',
                webrtcTitle: 'üîí Ki·ªÉm Tra R√≤ R·ªâ WebRTC',
                webrtcNote: 'WebRTC l√† t√≠nh nƒÉng tr√¨nh duy·ªát c√≥ th·ªÉ b·ªè qua VPN v√† l√†m l·ªô IP th·∫≠t. N·∫øu "IP Ri√™ng T∆∞/Th·∫≠t" kh·ªõp v·ªõi IP VPN, b·∫°n an to√†n.',
                webrtcLabel: 'IP Ri√™ng T∆∞/Th·∫≠t:',
                webrtcSafe: 'AN TO√ÄN',
                webrtcLeaking: 'PH√ÅT HI·ªÜN R√í R·ªà',
                webrtcChecking: 'ƒêang ki·ªÉm tra...',
                whoisTitle: 'üîç Th√¥ng tin Whois',
                whoisLoading: 'ƒêang t·∫£i chi ti·∫øt k·ªπ thu·∫≠t...'
            }
        };

        let currentLang = 'EN'; 
        let currentTheme = 'dark'; 
        let userIpv4 = null, userIpv6 = null, currentGeoData = null, currentGeoIp = null;

        function applyTheme() {
            const isDark = currentTheme === 'dark';
            const body = document.body;
            const ipCard = document.getElementById('ip-card');
            const eduCard = document.getElementById('edu-card');
            const searchSection = document.getElementById('ip-search-section');
            const searchInput = document.getElementById('ip-search-input');
            const warningNote = document.getElementById('geoip-warning-note');
            const webrtcSection = document.getElementById('webrtc-section');
            const footerPriv = document.getElementById('footer-privacy-text');
            const whoisSection = document.getElementById('whois-section');
            
            if (isDark) {
                body.classList.add('bg-primary-dark', 'text-gray-100');
                body.classList.remove('bg-gray-50', 'text-gray-900');
                ipCard.className = "ip-card w-full max-w-2xl p-6 md:p-10 rounded-xl text-center mb-8 bg-secondary-dark border border-gray-700 loaded";
                eduCard.className = "p-6 md:p-8 rounded-xl bg-secondary-dark border border-gray-700 shadow-2xl text-white";
                searchSection.className = "p-4 rounded-xl border-2 border-dashed mb-8 border-gray-700";
                searchInput.className = "flex-grow p-3 rounded-lg border bg-gray-900 border-gray-700 text-white focus:ring-accent";
                warningNote.className = "mt-6 p-4 rounded-xl border-l-4 bg-yellow-900/30 border-yellow-500 text-yellow-100";
                webrtcSection.className = "mt-8 p-6 rounded-xl border border-dashed border-gray-700 text-left bg-black/10";
                footerPriv.className = "mb-2 text-gray-500";
                whoisSection.className = "mt-8 pt-6 border-t border-gray-700/30 text-left";
            } else {
                body.classList.remove('bg-primary-dark', 'text-gray-100');
                body.classList.add('bg-gray-50', 'text-gray-900');
                ipCard.className = "ip-card w-full max-w-2xl p-6 md:p-10 rounded-xl text-center mb-8 bg-white border border-gray-200 shadow-xl loaded";
                eduCard.className = "p-6 md:p-8 rounded-xl bg-white border border-gray-200 shadow-lg text-gray-800";
                searchSection.className = "p-4 rounded-xl border-2 border-dashed mb-8 border-gray-200";
                searchInput.className = "flex-grow p-3 rounded-lg border bg-gray-50 border-gray-300 text-gray-900 focus:ring-accent";
                warningNote.className = "mt-6 p-4 rounded-xl border-l-4 bg-yellow-50 border-yellow-500 text-yellow-900";
                webrtcSection.className = "mt-8 p-6 rounded-xl border border-dashed border-gray-300 text-left bg-gray-50";
                footerPriv.className = "mb-2 text-gray-600";
                whoisSection.className = "mt-8 pt-6 border-t border-gray-200 text-left";
            }

            ['ipv4-block', 'ipv6-block'].forEach(id => {
                const el = document.getElementById(id);
                el.className = isDark ? 'p-6 rounded-xl bg-gray-800 border border-gray-700' : 'p-6 rounded-xl bg-white border border-gray-200 shadow-sm';
            });

            document.getElementById('theme-toggle').innerHTML = isDark ? 'üåô' : '‚òÄÔ∏è';
            const langSelect = document.getElementById('lang-selector');
            langSelect.className = isDark ? 
                "px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-sm border border-gray-700 bg-secondary-dark text-white outline-none cursor-pointer" :
                "px-3 py-1 text-sm font-medium rounded-full transition duration-200 shadow-sm border border-gray-300 bg-white text-gray-800 outline-none cursor-pointer";

            renderGeoDetails(currentGeoData, currentGeoIp);
            updateIpUI();
        }

        async function fetchWhois(ip) {
            const section = document.getElementById('whois-section');
            const content = document.getElementById('whois-content');
            section.classList.remove('hidden');
            content.innerHTML = `<div class="loader mx-auto"></div>`;

            // RIR endpoints for RDAP
            const rirs = [
                'https://rdap.arin.net/registry/ip/',
                'https://rdap.db.ripe.net/ip/',
                'https://rdap.apnic.net/ip/',
                'https://rdap.lacnic.net/rdap/ip/',
                'https://rdap.afrinic.net/rdap/ip/'
            ];

            async function tryFetchRDAP(ip) {
                // Determine which RIR might have the data based on first fetch or try all
                for (let baseUrl of rirs) {
                    try {
                        const response = await fetch(`${baseUrl}${ip}`, { method: 'GET' });
                        if (response.ok) return await response.json();
                    } catch (e) {}
                }
                return null;
            }

            try {
                const data = await tryFetchRDAP(ip);
                if (!data) throw new Error("Could not fetch RDAP data");

                let html = ``;
                
                // Helper to format line
                const line = (lbl, val) => `<div class="mb-1"><span class="whois-label">${lbl}:</span> <span class="whois-value">${val || 'N/A'}</span></div>`;

                // 1. Network Info
                html += `<div class="whois-section-title">Network Information</div>`;
                html += line('Network Name', data.name);
                html += line('IP Range', `${data.startAddress} - ${data.endAddress}`);
                html += line('IP Version', data.ipVersion?.toUpperCase());
                html += line('RIR Source', data.port43 || 'RDAP Registry');
                
                // Extract CIDR if available
                if (data.cidr0_cidrs) {
                    const cidrs = data.cidr0_cidrs.map(c => `${c.v4prefix || c.v6prefix}/${c.length}`).join(', ');
                    html += line('CIDR', cidrs);
                }

                // 2. Organization Info
                html += `<div class="whois-section-title">Organization / Entity</div>`;
                const mainEntity = data.entities?.find(e => e.roles?.includes('registrant')) || data.entities?.[0];
                
                if (mainEntity) {
                    const vcard = mainEntity.vcardArray?.[1];
                    const fn = vcard?.find(i => i[0] === 'fn')?.[3];
                    const org = vcard?.find(i => i[0] === 'org')?.[3];
                    const adr = vcard?.find(i => i[0] === 'adr')?.[3];
                    
                    html += line('Entity Name', fn || org);
                    html += line('Registry ID', mainEntity.handle);
                    if (adr) html += line('Address', adr.filter(x => x).join(', '));
                }

                // 3. Status & Dates
                html += `<div class="whois-section-title">Registration Status</div>`;
                html += line('Status', data.status?.join(', '));
                
                if (data.events) {
                    const regDate = data.events.find(e => e.eventAction === 'registration')?.eventDate;
                    const lastMod = data.events.find(e => e.eventAction === 'last changed')?.eventDate;
                    if (regDate) html += line('Registered', new Date(regDate).toLocaleDateString());
                    if (lastMod) html += line('Last Updated', new Date(lastMod).toLocaleDateString());
                }

                // 4. Abuse & Technical Contacts
                html += `<div class="whois-section-title">Contact Information</div>`;
                const contacts = (data.entities || []).flatMap(e => {
                    const role = e.roles?.join(', ');
                    const vc = e.vcardArray?.[1];
                    const email = vc?.find(i => i[0] === 'email')?.[3];
                    const phone = vc?.find(i => i[0] === 'tel')?.[3];
                    return email ? { role, email, phone } : [];
                });

                if (contacts.length > 0) {
                    contacts.forEach(c => {
                        html += `<div class="mb-2 p-2 bg-white/5 rounded">
                            <span class="text-accent font-bold text-[10px] block uppercase">${c.role}</span>
                            <div class="flex justify-between">
                                <span>${c.email}</span>
                                <span class="opacity-50">${c.phone || ''}</span>
                            </div>
                        </div>`;
                    });
                } else {
                    html += `<div class="opacity-50 italic">No public contact info available in registry.</div>`;
                }

                content.innerHTML = html;
            } catch (e) {
                content.innerHTML = `<div class="text-red-400">Detailed Whois lookup failed for ${ip}.<br>This usually happens with private ranges or temporary RIR timeout.</div>`;
            }
        }

        async function checkWebRTCLeak() {
            const statusBadge = document.getElementById('webrtc-status-badge');
            const localIpDisplay = document.getElementById('webrtc-local-ip');
            const foundIps = new Set();
            
            try {
                const pc = new RTCPeerConnection({
                    iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
                });
                pc.createDataChannel("");
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) {
                        if (foundIps.size === 0) {
                            localIpDisplay.textContent = "Protected";
                            statusBadge.className = "webrtc-tag bg-green-500 text-white";
                            statusBadge.textContent = languageMap[currentLang].webrtcSafe;
                        }
                        return;
                    }
                    const candidate = ice.candidate.candidate;
                    const ipMatch = /([0-9]{1,3}(\.[0-9]{1,3}){3})|([a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(candidate);
                    if (ipMatch) {
                        const ip = ipMatch[0];
                        foundIps.add(ip);
                        localIpDisplay.textContent = Array.from(foundIps).join(', ');
                        statusBadge.textContent = languageMap[currentLang].webrtcSafe;
                        statusBadge.className = "webrtc-tag bg-green-600 text-white";
                    }
                };
            } catch (e) {}
        }

        function updateIpUI() {
            const lang = languageMap[currentLang];
            updateIpBlock(userIpv4, 'ipv4-display', 'copy-ipv4-button', 'copy-ipv4-text', lang.copy, 'text-3xl md:text-5xl');
            updateIpBlock(userIpv6, 'ipv6-display', 'copy-ipv6-button', 'copy-ipv6-text', lang.copy, 'text-xl md:text-3xl');
        }

        function updateIpBlock(ip, displayId, buttonId, textId, btnText, size) {
            const display = document.getElementById(displayId);
            const btn = document.getElementById(buttonId);
            const txt = document.getElementById(textId);
            if (ip) {
                display.innerHTML = `<p class="${size} font-extrabold text-accent break-all ip-clickable" onclick="fetchWhois('${ip}')">${ip}</p>`;
                txt.textContent = btnText;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    const temp = document.createElement('textarea'); temp.value = ip; document.body.appendChild(temp); temp.select();
                    document.execCommand('copy');
                    txt.textContent = languageMap[currentLang].copied; setTimeout(()=> txt.textContent = btnText, 1500);
                    document.body.removeChild(temp);
                };
                btn.disabled = false; btn.classList.remove('opacity-0', 'pointer-events-none');
            } else if (userIpv4 !== null || userIpv6 !== null) {
                display.innerHTML = `<p class="text-xl text-gray-500">${languageMap[currentLang].notDetected}</p>`;
            }
        }

        function translatePage() {
            const lang = languageMap[currentLang];
            document.getElementById('detected-ip-title').textContent = lang.detectedIpTitle;
            document.getElementById('search-title').textContent = lang.searchToolTitle;
            document.getElementById('ip-search-input').placeholder = lang.searchPlaceholder;
            document.getElementById('ip-search-button').textContent = lang.searchButton;
            document.getElementById('geo-details-title').textContent = lang.geoDetailsTitle;
            document.getElementById('geo-warning-title').textContent = lang.geoWarningTitle;
            document.getElementById('geo-warning-text').textContent = lang.geoWarningText;
            document.getElementById('edu-section-title').textContent = lang.eduTitle;
            document.getElementById('edu-win-desc').textContent = lang.eduWinDesc;
            document.getElementById('edu-linux-desc').textContent = lang.eduLinuxDesc;
            document.getElementById('edu-footer-note').innerHTML = lang.eduFooter;
            document.getElementById('footer-privacy-text').textContent = lang.footerPrivacy;
            applyTheme();
        }

        function renderGeoDetails(data, ip) {
            const lang = languageMap[currentLang];
            const isDark = currentTheme === 'dark';
            const display = document.getElementById('geo-display');
            if (!data) return;
            currentGeoData = data; currentGeoIp = ip;
            const cardBg = isDark ? 'bg-gray-700/50' : 'bg-gray-100';
            const labelColor = isDark ? 'text-gray-400' : 'text-gray-500';
            display.className = "grid grid-cols-2 gap-3 w-full text-left mt-4";
            display.innerHTML = ['country', 'city', 'timezone', 'asn', 'isp'].map(k => `
                <div class="col-span-2 md:col-span-1 p-3 rounded-lg ${cardBg}">
                    <span class="block text-xs font-bold uppercase ${labelColor}">${lang[k]}</span>
                    <span class="font-bold">${data[k] || 'N/A'}</span>
                </div>
            `).join('') + `
                <div class="col-span-2 p-3 rounded-lg border ${data.isProxy || data.isVpn ? 'border-red-500/30 bg-red-500/10' : 'border-green-500/30 bg-green-500/10'}">
                    <span class="block text-xs font-bold uppercase ${labelColor}">${lang.securityTitle}</span>
                    <span class="font-bold ${data.isProxy || data.isVpn ? 'text-red-500' : 'text-green-600'}">${data.isProxy || data.isVpn ? lang.detected : lang.isClean}</span>
                </div>
            `;
        }

        async function fetchIPs() {
            try {
                const [v4res, v6res] = await Promise.allSettled([
                    fetch('https://api.ipify.org?format=json').then(r => r.json()),
                    fetch('https://api6.ipify.org?format=json').then(r => r.json())
                ]);
                userIpv4 = v4res.status === 'fulfilled' ? v4res.value.ip : null;
                userIpv6 = v6res.status === 'fulfilled' ? v6res.value.ip : null;
                const geoRes = await fetch(`https://ipapi.co/${userIpv4 || userIpv6}/json/`);
                const geoData = await geoRes.json();
                renderGeoDetails({ country: geoData.country_name, city: geoData.city, isp: geoData.org, asn: geoData.asn, timezone: geoData.timezone, isProxy: geoData.proxy, isVpn: geoData.vpn }, userIpv4 || userIpv6);
                updateIpUI();
                checkWebRTCLeak();
            } catch (e) {}
        }

        document.getElementById('lang-selector').addEventListener('change', (e) => { currentLang = e.target.value; translatePage(); });
        document.getElementById('theme-toggle').addEventListener('click', () => { currentTheme = currentTheme === 'dark' ? 'light' : 'dark'; applyTheme(); });
        document.getElementById('ip-search-button').addEventListener('click', async () => {
            const ip = document.getElementById('ip-search-input').value.trim();
            if(!ip) return;
            const res = await fetch(`https://ipapi.co/${ip}/json/`);
            const data = await res.json();
            renderGeoDetails({ country: data.country_name, city: data.city, isp: data.org, asn: data.asn, timezone: data.timezone, isProxy: data.proxy, isVpn: data.vpn }, ip);
            fetchWhois(ip);
        });

        window.onload = () => { fetchIPs(); translatePage(); };
    </script>
</body>
</html>
