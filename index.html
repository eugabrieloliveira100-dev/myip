<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Preconnect & DNS-Prefetch para Performance M√°xima (Core Web Vitals) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://api.ipify.org">
    <link rel="dns-prefetch" href="https://ip-api.com">
    <link rel="dns-prefetch" href="https://ipwho.is">

    <!-- SEO & Meta Tags -->
    <title id="meta-title">Check My IP Today - Find my Public IPv4, IPv6 & Network Details</title>
    <meta name="description" id="meta-desc" content="Instant public IP address lookup. Find your IPv4, IPv6, ISP, ASN, and detailed network location with CheckMyIP.Today. Global network intelligence tool for users and developers.">
    <meta name="keywords" content="check my ip, what is my ip, ipv4, ipv6, asn lookup, rdap, network intelligence, isp checker, curl ip, whois">
    <link rel="canonical" href="https://checkmyip.today">

    <!-- Schema.org JSON-LD (SEO Invis√≠vel) -->
    <script type="application/ld+json">
    [
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "CheckMyIP.Today",
        "operatingSystem": "All",
        "applicationCategory": "UtilitiesApplication",
        "url": "https://checkmyip.today",
        "description": "Professional tool for IP address detection and network intelligence.",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "featureList": ["IPv4/IPv6 Detection", "Real-time Geolocation", "ASN Analysis", "RDAP Data", "Terminal Query"]
      }
    ]
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Otimiza√ß√£o de Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <style>
        :root { --bg-deep: #020617; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-deep); color: #f1f5f9; padding: 1rem; margin: 0; min-height: 100vh; text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; }
        
        .glass-card { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            transition: border-color 0.3s ease; 
            min-height: 140px; 
            contain: paint; 
        }
        
        .info-value { 
            min-height: 1.5rem; 
            display: inline-block; 
            min-width: 50px; 
        }

        #copy-toast { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #10b981; color: white; padding: 10px 20px; border-radius: 99px; font-size: 12px; font-weight: bold; z-index: 2000; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2); }
        .prose-content h2 { font-size: 1.3rem; font-weight: 800; border-left: 4px solid #3b82f6; padding-left: 1rem; margin: 2rem 0 1rem; color: white; }
        .prose-content p { color: #94a3b8; font-size: 0.95rem; margin-bottom: 1.2rem; line-height: 1.6; }
        .edu-block { border-radius: 1.5rem; padding: 1.5rem; background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(255, 255, 255, 0.03); margin-bottom: 1.5rem; }
        
        .prerender-text { color: rgba(148, 163, 184, 0.4); font-style: normal; }
    </style>
</head>
<body>
    <div id="copy-toast">‚úÖ REPORT COPIED</div>

    <div class="max-w-5xl mx-auto flex flex-col gap-6">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center gap-4 bg-slate-900/50 p-6 rounded-3xl border border-white/5">
            <div class="cursor-pointer" onclick="location.reload()">
                <h1 class="text-2xl font-extrabold tracking-tight text-white uppercase">CHECKMYIP.<span class="text-blue-500">TODAY</span></h1>
                <p id="tagline" class="text-slate-500 text-[10px] font-mono uppercase tracking-widest">Global Network Intelligence</p>
            </div>
            <nav class="flex flex-wrap items-center justify-center gap-3">
                <button onclick="location.reload()" class="bg-slate-800 hover:bg-slate-700 text-white text-[10px] font-extrabold px-4 py-2 rounded-full border border-white/10 transition-all">
                    <span id="btn-reset">MY CONNECTION</span>
                </button>
                <select id="lang-select" aria-label="Select Language" onchange="changeLanguage()" class="bg-slate-800 text-white text-[10px] font-bold px-4 py-2 rounded-full border border-white/10 outline-none cursor-pointer">
                    <option value="en">ENGLISH</option>
                    <option value="pt">PORTUGU√äS</option>
                    <option value="ru">–†–£–°–°–ö–ò–ô</option>
                </select>
                <button onclick="copyPageSummary()" class="bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-extrabold px-4 py-2 rounded-full transition-all">
                    <span id="btn-copy">COPY SUMMARY</span>
                </button>
            </nav>
        </header>

        <!-- Main IP Display -->
        <main class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <section class="glass-card p-8 rounded-3xl relative flex flex-col justify-center">
                <span id="label-v4-tag" class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-lg text-[10px] font-bold uppercase mb-4 w-fit italic">IPv4 Address</span>
                <h2 id="label-v4" class="text-slate-500 text-xs font-bold mb-1 uppercase">Your Public IP Address:</h2>
                <div id="ipv4-display" class="text-3xl md:text-4xl font-black text-white font-mono italic opacity-20">0.0.0.0</div>
            </section>
            <section class="glass-card p-8 rounded-3xl relative flex flex-col justify-center">
                <span id="label-v6-tag" class="bg-purple-500/10 text-purple-400 px-3 py-1 rounded-lg text-[10px] font-bold uppercase mb-4 w-fit italic">IPv6 Address</span>
                <h2 id="label-v6" class="text-slate-500 text-xs font-bold mb-1 uppercase">Your IPv6 Connectivity:</h2>
                <div id="ipv6-display" class="text-lg md:text-xl font-black font-mono text-purple-200 italic opacity-20">::1</div>
            </section>
        </main>

        <!-- Geolocation & Provider -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-card p-6 rounded-3xl border-l-4 border-l-blue-500">
                <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4" id="title-location">Physical Location</h3>
                <div class="text-sm space-y-2">
                    <div class="flex justify-between border-b border-white/5 pb-1"><span id="label-city">City</span><span id="info-city" class="info-value prerender-text">Searching...</span></div>
                    <div class="flex justify-between border-b border-white/5 pb-1"><span id="label-region">Region</span><span id="info-region" class="info-value prerender-text">Searching...</span></div>
                    <div class="flex justify-between"><span id="label-country">Country</span><span id="info-country" class="info-value prerender-text">Searching...</span></div>
                </div>
            </div>

            <div class="glass-card p-6 rounded-3xl border-l-4 border-l-emerald-500">
                <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4" id="title-provider">Provider Details</h3>
                <div class="flex flex-col gap-3 text-sm">
                    <div>
                        <span id="label-isp" class="text-[9px] text-slate-500 uppercase block font-bold">ISP (Internet Service Provider)</span>
                        <div id="info-isp" class="info-value prerender-text text-blue-400">Loading...</div>
                    </div>
                    <div>
                        <span id="label-org" class="text-[9px] text-slate-500 uppercase block font-bold">Organization</span>
                        <div id="info-org" class="info-value prerender-text text-white">Loading...</div>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 rounded-3xl border-l-4 border-l-orange-500">
                <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4" id="title-asn-details">ASN & Routing</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <span id="label-as-title" class="text-[9px] text-slate-500 uppercase block font-bold">Autonomous System Number</span>
                        <div id="info-asn" class="info-value prerender-text text-blue-400">Querying...</div>
                    </div>
                    <div class="bg-black/20 p-2 rounded-lg font-mono">
                        <span id="label-terminal" class="text-[8px] text-slate-500 uppercase block">üíª Terminal Query</span>
                        <code id="info-host" class="text-[10px] text-slate-300 italic">curl checkmyip.today</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- RDAP Data -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-card p-6 rounded-3xl">
                <h3 id="title-rdap" class="text-[10px] text-slate-500 font-bold uppercase mb-4">Registry & Allocation (RDAP Protocol)</h3>
                <div class="grid grid-cols-2 gap-4 text-[11px]">
                    <div class="bg-slate-900/40 p-3 rounded-xl border border-white/5"><span id="label-reg-date" class="text-slate-500 block">Registration Date</span><span id="registry-created" class="info-value prerender-text">...</span></div>
                    <div class="bg-slate-900/40 p-3 rounded-xl border border-white/5"><span id="label-last-update" class="text-slate-500 block">Last Update</span><span id="registry-updated" class="info-value prerender-text">...</span></div>
                </div>
            </div>
            <div class="glass-card p-6 rounded-3xl">
                <h3 id="title-abuse" class="text-[10px] text-slate-500 font-bold uppercase mb-4">Abuse Contacts & Reporting</h3>
                <div class="grid grid-cols-2 gap-4 text-[11px]">
                    <div class="bg-slate-900/40 p-3 rounded-xl border border-white/5 truncate"><span id="label-support" class="text-slate-500 block">Support Contact</span><span id="registry-email" class="info-value prerender-text">...</span></div>
                    <div class="bg-slate-900/40 p-3 rounded-xl border border-white/5 truncate"><span id="label-abuse-email" class="text-slate-500 block">Abuse Report</span><span id="registry-abuse" class="info-value prerender-text">...</span></div>
                </div>
            </div>
        </div>

        <!-- Search -->
        <section class="glass-card p-8 rounded-3xl">
            <div class="flex flex-col md:flex-row justify-between gap-6">
                <div>
                    <h2 class="text-lg font-bold">üîç <span id="title-search">Network Intelligence Search</span></h2>
                    <p id="sub-search" class="text-slate-500 text-xs">Analyze ASN, ISP, and WHOIS records for any IP Address globally.</p>
                </div>
                <div class="flex bg-black/40 border border-white/10 rounded-2xl overflow-hidden focus-within:border-blue-500">
                    <input type="text" id="ip-lookup-input" placeholder="8.8.8.8" aria-label="IP Address Search" class="bg-transparent px-4 py-2 text-sm outline-none w-48 font-mono text-white">
                    <button onclick="manualLookup()" aria-label="Search IP" class="bg-blue-600 px-6 hover:bg-blue-500 transition-all text-white"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </section>

        <!-- Educational Content -->
        <article id="edu-container" class="prose-content"></article>

        <footer class="mt-8 mb-12 py-8 border-t border-white/5 text-center">
            <div class="text-[10px] font-mono text-slate-600 uppercase tracking-widest">
                &copy; 2024 CheckMyIP.Today ‚Ä¢ <span id="footer-tag">Professional Network Intelligence Tool</span>
            </div>
        </footer>
    </div>

    <script>
        const translations = {
            en: { 
                tagline: "Global Network Intelligence", btnCopy: "COPY SUMMARY", btnReset: "MY CONNECTION", ipv4: "Your Public IP Address:", ipv6: "Your IPv6 Connectivity:", location: "Physical Location", city: "City", region: "Region", country: "Country", provider: "Provider Details", isp: "ISP (Internet Service Provider)", org: "Organization", search: "Network Intelligence Search", subSearch: "Analyze ASN, ISP, and WHOIS records for any IP Address globally.", terminal: "üíª Terminal Query", footer: "Professional Network Intelligence Tool", toast: "‚úÖ REPORT COPIED", rdap: "Registry & Allocation (RDAP Protocol)", abuse: "Abuse Contacts & Reporting", regDate: "Registration Date", lastUpdate: "Last Update", support: "Support Contact", abuseEmail: "Abuse Report", asnDetails: "ASN & Routing", asTitle: "Autonomous System Number",
                edu: [
                    { h: "What is an IP Address?", p: "An IP address is a unique identifier for devices on a network, allowing data to be sent via the Internet Protocol." },
                    { h: "About CheckMyIP.Today", p: "We provide instant forensics on your network connection, including geolocation, ISP verification, and RDAP records." },
                    { h: "Key Features", p: "Real-time dual-stack detection, ASN routing analysis, and WHOIS/RDAP database integration." },
                    { h: "Local vs. Public IP", p: "Your Public IP is your global identity, while a Local IP (LAN) is used only within your private network." },
                    { h: "How Geolocation Works", p: "IP Geolocation technology maps your digital connection to a physical location using ISP databases." },
                    { h: "Alternative Trusted Checkers", p: "Industry standards include IPinfo.io, icanhazip.com, and WhatIsMyIP.com." }
                ]
            },
            pt: { 
                tagline: "Intelig√™ncia de Rede Global", btnCopy: "COPIAR RESUMO", btnReset: "MINHA CONEX√ÉO", ipv4: "Seu Endere√ßo IP P√∫blico:", ipv6: "Sua Conectividade IPv6:", location: "Localiza√ß√£o F√≠sica", city: "Cidade", region: "Regi√£o", country: "Pa√≠s", provider: "Detalhes do Provedor", isp: "ISP (Internet Service Provider)", org: "Organiza√ß√£o", search: "Busca de Intelig√™ncia de Rede", subSearch: "Analise registros de ASN, ISP e WHOIS para qualquer IP globalmente.", terminal: "üíª Terminal Query", footer: "Ferramenta Profissional de Intelig√™ncia de Rede", toast: "‚úÖ RELAT√ìRIO COPIADO", rdap: "Registro e Aloca√ß√£o (Protocolo RDAP)", abuse: "Contatos de Abuso e Den√∫ncia", regDate: "Data de Registro", lastUpdate: "√öltima Atualiza√ß√£o", support: "Contato de Suporte", abuseEmail: "Relat√≥rio de Abuso", asnDetails: "ASN e Roteamento", asTitle: "N√∫mero de Sistema Aut√¥nomo",
                edu: [
                    { h: "O que √© um Endere√ßo IP?", p: "Um endere√ßo IP √© um identificador exclusivo para dispositivos em uma rede, permitindo o tr√°fego de dados via Protocolo de Internet." },
                    { h: "Sobre o CheckMyIP.Today", p: "Fornecemos an√°lise forense instant√¢nea de sua conex√£o, incluindo geolocaliza√ß√£o e registros de propriedade RDAP." },
                    { h: "Recursos Principais", p: "Detec√ß√£o em tempo real de IPv4/IPv6, an√°lise ASN e integra√ß√£o com bancos WHOIS/RDAP." },
                    { h: "IP Local vs. P√∫blico", p: "Seu IP P√∫blico √© sua identidade global, enquanto o IP Local √© usado apenas internamente." },
                    { h: "Como funciona a Geolocaliza√ß√£o", p: "Mapeia sua conex√£o digital para um local f√≠sico usando bancos de dados de infraestrutura de rede." },
                    { h: "Verificadores Confi√°veis Alternativos", p: "Outras op√ß√µes confi√°veis incluem IPinfo, icanhazip e WhatIsMyIP." }
                ]
            },
            ru: { 
                tagline: "–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è —Ä–∞–∑–≤–µ–¥–∫–∞", btnCopy: "–ö–û–ü–ò–†–û–í–ê–¢–¨", btnReset: "–ú–û–ï –°–û–ï–î–ò–ù–ï–ù–ò–ï", ipv4: "–í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π IP-–∞–¥—Ä–µ—Å:", ipv6: "–í–∞—à–µ IPv6-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:", location: "–§–∏–∑–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", city: "–ì–æ—Ä–æ–¥", region: "–†–µ–≥–∏–æ–Ω", country: "–°—Ç—Ä–∞–Ω–∞", provider: "–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞", isp: "ISP (Internet Service Provider)", org: "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", search: "–ü–æ–∏—Å–∫ —Å–µ—Ç–µ–≤–æ–π —Ä–∞–∑–≤–µ–¥–∫–∏", subSearch: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø–∏—Å–∏ ASN, ISP –∏ WHOIS –¥–ª—è –ª—é–±–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞.", terminal: "üíª Terminal Query", footer: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–µ—Ç–µ–≤–æ–π —Ä–∞–∑–≤–µ–¥–∫–∏", toast: "‚úÖ –û–¢–ß–ï–¢ –°–ö–û–ü–ò–†–û–í–ê–ù", rdap: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (RDAP)", abuse: "–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –∂–∞–ª–æ–±", regDate: "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", lastUpdate: "–û–±–Ω–æ–≤–ª–µ–Ω–æ", support: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞", abuseEmail: "–ñ–∞–ª–æ–±–∞ –Ω–∞ –∞–±—É–∑", asnDetails: "ASN –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è", asTitle: "–ù–æ–º–µ—Ä –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã",
                edu: [
                    { h: "–ß—Ç–æ —Ç–∞–∫–æ–µ IP-–∞–¥—Ä–µ—Å?", p: "IP-–∞–¥—Ä–µ—Å ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Å–µ—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö." },
                    { h: "–û CheckMyIP.Today", p: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –≤–∞—à–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è, –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –¥–∞–Ω–Ω—ã–µ RDAP." },
                    { h: "–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏", p: "–î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IPv4/IPv6, –∞–Ω–∞–ª–∏–∑ ASN –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–∞–º–∏ WHOIS/RDAP." },
                    { h: "–õ–æ–∫–∞–ª—å–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π IP", p: "–ü—É–±–ª–∏—á–Ω—ã–π IP ‚Äî —ç—Ç–æ –≤–∞—à ID –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ, –ª–æ–∫–∞–ª—å–Ω—ã–π ‚Äî —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏." },
                    { h: "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è", p: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –∞–¥—Ä–µ—Å–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤." },
                    { h: "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã", p: "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã: IPinfo, icanhazip –∏ WhatIsMyIP." }
                ]
            }
        };

        let currentLang = 'en';

        function setField(id, val) {
            const el = document.getElementById(id);
            if (!el) return;
            const finalVal = (val && String(val).trim() !== "" && String(val).toLowerCase() !== "null") ? val : "N/A";
            el.innerText = finalVal;
            el.classList.remove('opacity-20', 'prerender-text');
        }

        async function fetchGeo(ip) {
            // Ordem das APIs otimizada para evitar bloqueios de CORS e problemas de conex√£o
            const endpoints = [
                `https://ip-api.com/json/${ip}?fields=status,message,country,regionName,city,isp,org,as,query`,
                `https://ipwho.is/${ip}`,
                `https://ipapi.co/${ip}/json/`
            ];

            for(const url of endpoints) {
                try {
                    // Timeout de 4 segundos para n√£o travar a p√°gina
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 4000);

                    const res = await fetch(url, { 
                        cache: 'no-cache',
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    
                    const d = await res.json();
                    
                    let city, region, country, isp, org, asn;

                    // Parse ip-api.com
                    if (url.includes('ip-api.com') && d.status === "success") {
                        city = d.city; region = d.regionName; country = d.country;
                        isp = d.isp; org = d.org; asn = d.as;
                    }
                    // Parse ipwho.is (o que apresentou erro no log do usu√°rio)
                    else if (url.includes('ipwho.is') && d.success) {
                        city = d.city; region = d.region; country = d.country;
                        isp = d.connection?.isp; org = d.connection?.org; asn = d.connection?.asn ? `AS${d.connection.asn}` : "";
                    } 
                    // Parse ipapi.co
                    else if (url.includes('ipapi.co') && !d.error) {
                        city = d.city; region = d.region; country = d.country_name;
                        isp = d.org; org = d.org; asn = d.asn;
                    }

                    // Se conseguimos dados m√≠nimos, aplicamos e paramos o loop
                    if (city || isp || asn) {
                        setField('info-city', city);
                        setField('info-region', region);
                        setField('info-country', country);
                        setField('info-isp', isp);
                        setField('info-org', org || isp);
                        setField('info-asn', asn);
                        
                        const metaTitle = `${ip} | ${city || 'Global'} Network Details - CheckMyIP.Today`;
                        document.title = metaTitle;
                        return true;
                    }
                } catch(e) { 
                    // Se falhar (Failed to fetch), apenas logamos e tentamos o pr√≥ximo endpoint
                    console.warn(`Silently failed fetch from ${url}:`, e.message); 
                }
            }
            
            // Fallback se todas as APIs falharem
            ['info-city', 'info-region', 'info-country', 'info-isp', 'info-org', 'info-asn'].forEach(id => setField(id, "N/A"));
            return false;
        }

        async function fetchRDAP(ip) {
            try {
                // Ripe RDAP costuma ser est√°vel, mas adicionamos try/catch
                const res = await fetch(`https://rdap.db.ripe.net/ip/${ip}`);
                const d = await res.json();
                const evts = d.events || [];
                setField('registry-created', (evts.find(e => e.eventAction==='registration')?.eventDate || "").split('T')[0]);
                setField('registry-updated', (evts.find(e => e.eventAction==='last changed')?.eventDate || "").split('T')[0]);
                
                let ab = "N/A", sp = "N/A";
                const scan = (ents) => ents?.forEach(e => {
                    const v = e.vcardArray?.[1];
                    const mail = v?.find(x => x[0]==='email')?.[3];
                    if(mail) e.roles?.includes('abuse') ? ab=mail : sp=mail;
                    if(e.entities) scan(e.entities);
                });
                scan(d.entities);
                setField('registry-email', sp); setField('registry-abuse', ab);
            } catch(e) {
                ['registry-created', 'registry-updated', 'registry-email', 'registry-abuse'].forEach(id => setField(id, "N/A"));
            }
        }

        async function lookup(ip, isManual = false) {
            const isV6 = ip.includes(':');
            setField(isV6 ? 'ipv6-display' : 'ipv4-display', ip);
            if (isManual && !isV6) setField('ipv6-display', "N/A");
            
            ['info-city', 'info-region', 'info-country', 'info-isp', 'info-org', 'info-asn'].forEach(id => {
                document.getElementById(id).innerText = "...";
                document.getElementById(id).classList.add('opacity-20');
            });

            document.getElementById('info-host').innerText = `curl checkmyip.today/${ip}`;
            // Executamos Geo e RDAP
            await Promise.all([fetchGeo(ip), fetchRDAP(ip)]);
        }

        async function init() {
            changeLanguage();
            try {
                // Tentar obter IP v4 via ipify (muito est√°vel)
                const r4 = await fetch('https://api.ipify.org?format=json');
                const d4 = await r4.json();
                lookup(d4.ip, false);

                // Tentar obter IP v6 em paralelo
                fetch('https://api64.ipify.org?format=json').then(r=>r.json()).then(v6 => {
                    if(v6.ip.includes(':')) setField('ipv6-display', v6.ip);
                }).catch(() => setField('ipv6-display', "NOT DETECTED"));
            } catch(e) { 
                setField('ipv4-display', "OFFLINE");
            }
        }

        function manualLookup() {
            const ip = document.getElementById('ip-lookup-input').value.trim();
            if(ip) lookup(ip, true);
        }

        function changeLanguage() {
            currentLang = document.getElementById('lang-select').value;
            const t = translations[currentLang];
            Object.keys(t).forEach(k => {
                if(k === 'edu') return;
                const el = document.getElementById(k) || document.getElementById(`label-${k}`) || document.getElementById(`title-${k}`);
                if(el) el.innerText = t[k];
            });
            document.getElementById('edu-container').innerHTML = t.edu.map(item => `
                <section class="edu-block">
                    <h2 class="text-white">${item.h}</h2>
                    <p>${item.p}</p>
                </section>
            `).join('');
        }

        function copyPageSummary() {
            const val = (id) => document.getElementById(id).innerText;
            const s = `CheckMyIP.Today Report\nIP: ${val('ipv4-display')}\nASN: ${val('info-asn')}\nISP: ${val('info-isp')}\nLoc: ${val('info-city')}, ${val('info-country')}`;
            const area = document.createElement('textarea');
            area.value = s; document.body.appendChild(area); area.select(); document.execCommand('copy'); document.body.removeChild(area);
            const toast = document.getElementById('copy-toast');
            toast.style.display = 'block'; setTimeout(() => toast.style.display = 'none', 2000);
        }

        window.onload = init;
    </script>
</body>
</html>
